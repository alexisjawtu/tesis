\section{Stability Estimates for Pyramidal Finite Elements} % (fold)
\label{sec:pyramidal_finite_elements}
$\hat{E}$ will be the reference pyramid  in Figure~\ref{reference_pyramid}.
Anisotropic interpolation error estimates for pyramidal $\bcurl$--conforming
and div--conforming finite elements of least order will we established.
\subsection{Anisotropic Stability Estimates for $H(\bcurl)$--Conforming 
Elements on Pyramids} % (fold)
\label{sub:edge_elements}
\input{./chap_additional/stability_edge_ref_pyramid}
% subsection edge_elements (end)
\subsection{Anisotropic Stability Estimates for $H(\text{div})$--Conforming 
Elements on Pyramids} % (fold)
\label{sub:face_elements}
Here we will work on the div--conforming analogue of
Theorem~\ref{aux_label53}.
\begin{theorem} \label{aux_label54}
\begin{IEEEeqnarray*}{rCl}
  \|(\rku)_1\|_{\scriptscriptstyle{L^\infty(\hat{E})}}
  &\lesssim& \|\hat u_1\|_{\scriptscriptstyle{W^{1,p}(\hat{E})}} +
    \|\dv \hat\bu\|_{\scriptscriptstyle{L^p}(\hat{E})} + 
    \left\|\hat{u}_3\right\|_{\scriptscriptstyle{W^{1,p}}(\hat{E})}\\[12pt]
  \|(\rku)_2\|_{\scriptscriptstyle{L^\infty(\hat{E})}}
  &\lesssim& \|\hat u_2\|_{\scriptscriptstyle{W^{1,p}(\hat{E})}} +
    \|\dv \hat\bu\|_{\scriptscriptstyle{L^p}(\hat{E})} + 
    \left\|\hat{u}_3\right\|_{\scriptscriptstyle{W^{1,p}}(\hat{E})}\\[12pt]
  \|(\rku)_3\|_{\scriptscriptstyle{L^\infty(\hat{E})}} & \lesssim & 
    \|\hat u_3\|_{\scriptscriptstyle{W^{1,p}(\hat{E})}} +
    \|\dv \hat\bu\|_{\scriptscriptstyle{L^p}(\hat{E})}.
\end{IEEEeqnarray*}
\end{theorem}
\begin{proof}
We will use the notation of Table~\ref{shape_face_table} for the 
shape functions and Tables~\ref{pyramidNotationTableFaces} and~\ref{pyramidNotationTableEdges}
for the boundary of the reference pyramid. This proof is based on explicit computation as well.
The variables 
in the local coordinate system of $\hat E$ for the shape functions $\hat\bz_i$ 
are $x$, $y$ and $z$ instead
of $\hat x_1$, $\hat x_2$ and $\hat x_3$.\\[5pt]
Consider the case $\hat{\bu} = (\hat{u}_1,0,0)'$ to start with and compute it's 
interpolate. 
\begin{IEEEeqnarray*}{rCl}
  \rku & = & \{{\scriptstyle\iint_{\hat{f}_2} \hat\bu \cdot \hat\bn_2\,d\hat S}\}\,\hat\bz_2 + 
             \{{\scriptstyle\iint_{\hat{f}_3} \hat\bu \cdot \hat\bn_3\,d\hat S}\}\,\hat\bz_3\\[4pt]
       & =: & \rho_2(\hat\bu)\,\hat\bz_2 + \rho_3(\hat\bu)\,\hat\bz_3.
\end{IEEEeqnarray*}
Then for the first two components of the interpolate it holds
\begin{IEEEeqnarray*}{rCl}
  (\rku)_1(x,y,z) & = & -2\rho_2(\hat\bu) + 
    \{\rho_2(\hat\bu)+\rho_3(\hat\bu)\}\,\tfrac{2x-xz}{1-z}\\[4pt]
    & = & -2{\iint_{\hat{f}_2} \hat{\bu} \cdot \hat\bn_2\,d\hat S}\\[4pt]
    &&\, +\,\left\{
          {\iint_{\hat{f}_2} \hat{\bu} \cdot \hat\bn_2\,d\hat S}+
                  {\iint_{\hat{f}_3} \hat{\bu} \cdot \hat\bn_3\,d\hat S}\right\}
                  \tfrac{2x-xz}{1-z}\\[4pt]
    & = & -2{\iint_{\hat{f}_2} \hat{\bu} \cdot \hat\bn_2\,d\hat S} + 
          {\iint_{\partial\hat{E}} \hat{\bu} \cdot \hat\bn\,d\hat S}\,\tfrac{2x-xz}{1-z}\\[4pt]
    & = & -2{\iint_{\hat{f}_2} \hat{\bu} \cdot \hat\bn_2\,d\hat S} + 
            {\int_{\hat{E}} \dv\hat{\bu} \,d\hat{\boldsymbol{x}}}\,\tfrac{2x-xz}{1-z}
\end{IEEEeqnarray*}
and
\begin{IEEEeqnarray*}{rCl}
  (\rku)_2\xyz & = & -(\rho_2(\hat\bu)+\rho_3(\hat\bu))\,\tfrac{yz}{1-z}\\[4pt]
    & = & -{\int_{\hat{E}} \dv\hat{\bu} \,d\hat{\boldsymbol{x}}}\,\tfrac{yz}{1-z}.
\end{IEEEeqnarray*}
Switch to $\hat{\bu}$ of the form $(0,\hat{u}_2,0)'$.
\begin{IEEEeqnarray*}{rCl}
  \rku & = & ({\scriptstyle\iint_{\hat{f}_1} \hat\bu \cdot \hat\bn_1\,d\hat S})\,\hat\bz_1 + 
         ({\scriptstyle\iint_{\hat{f}_4} \hat\bu \cdot \hat\bn_4\,d\hat S})\,\hat\bz_4\\[4pt]
       & = & \rho_1(\hat\bu)\,\hat\bz_1 + \rho_4(\hat\bu)\,\hat\bz_4.
\end{IEEEeqnarray*}
Then summing up yields, for now,
\begin{IEEEeqnarray*}{rCl}
  (\rku)_1(x,y,z) & = & -(\rho_1(\hat\bu)+\rho_4(\hat\bu))\,\tfrac{xz}{1-z}\\[4pt]
    & = & -{\int_{\hat{E}} \dv\hat{\bu} \,d\hat{\boldsymbol{x}}}\,\tfrac{xz}{1-z}.\\[8pt]
  (\rku)_2(x,y,z) & = & -2\rho_1(\hat\bu) + 
  (\rho_1(\hat\bu)+\rho_4(\hat\bu))\,\tfrac{2y-yz}{1-z}\\[4pt]
    & = & -2{\iint_{\hat{f}_1} \hat{\bu} \cdot \hat\bn_1\,d\hat S} + 
            {\iint_{\partial\hat{E}} \hat{\bu} \cdot \hat\bn\,d\hat S}\,\tfrac{2y-yz}{1-z}\\[4pt]
    & = & -2{\iint_{\hat{f}_1} \hat{\bu} \cdot \hat\bn_1\,d\hat S} + 
            {\int_{\hat{E}} \dv\hat{\bu} \,d\hat{\boldsymbol{x}}}\,\tfrac{2y-yz}{1-z}.\\[8pt]
\end{IEEEeqnarray*}
Now continue with $\hat{\bu}$ of the form $(0,0,\hat{u}_3)'$.
\begin{IEEEeqnarray*}{rCl}
  \rku & = & ({\scriptstyle\iint_{\hat{f}_3} \hat\bu \cdot \hat\bn_3\,d\hat S})\,\hat\bz_3 + 
         ({\scriptstyle\iint_{\hat{f}_4} \hat\bu \cdot \hat\bn_4\,d\hat S})\,\hat\bz_4 + 
         ({\scriptstyle\iint_{\hat{f}_5} \hat\bu \cdot \hat\bn_5\,d\hat S})\,\hat\bz_5\\[4pt]
       & =: & \rho_3(\hat\bu)\,\hat\bz_3 + \rho_4(\hat\bu)\,\hat\bz_4
       + \rho_5(\hat\bu)\,\hat\bz_5.
\end{IEEEeqnarray*}
Then
\begin{IEEEeqnarray*}{rCl}
  (\rku)_1(x,y,z) & = & \{\rho_3(\hat\bu) + \rho_5(\hat\bu)\}\,x
  + \rho_3(\hat\bu) \tfrac{x}{1-z} - \rho_4\tfrac{xz}{1-z}.
\end{IEEEeqnarray*}
Now observe that
\begin{IEEEeqnarray*}{rCl}
  (\rho_3 + \rho_5)(\hat\bu) & = & 
    {\iint_{\partial\hat{E}} \hat{\bu} \cdot \hat\bn\,d\hat S} - 
      {\iint_{\hat{f}_4} \hat{\bu} \cdot \hat\bn_4\,d\hat S} \\[4pt]
  & = & {\int_{\hat{E}} \dv\hat{\bu}\,d\hat{\boldsymbol{x}}} - 
        \rho_4(\hat{\bu})
\end{IEEEeqnarray*}
and, on the other hand,
\begin{IEEEeqnarray*}{rCl}
  (\rho_3-\rho_4)(\hat\bu) & = & 
  {\iint_{\hat{f}_3} \hat\bu \cdot \hat\bn_3\,d\hat S} - 
  {\iint_{\hat{f}_4} \hat\bu \cdot \hat\bn_4\,d\hat S} \\[4pt]
  & = & \int_{0}^{1}\int_{0}^{x} \hat{u}_3(x,y,1-x)\,dydx - 
        \int_{0}^{1}\int_{0}^{y} \hat{u}_3(x,y,1-y)\,dxdy\mbox{,}
\end{IEEEeqnarray*}
so
\begin{IEEEeqnarray*}{rCl}
  (\rku)_1(x,y,z) & = & {x\int_{\hat{E}} \dv\hat{\bu}\,d\hat{\boldsymbol{x}}}\,+\\[4pt]
  \IEEEeqnarraymulticol{3}{r}{
    \qquad\left\{\int_{0}^{1}\int_{0}^{x} \hat{u}_3(x,y,1-x)\,dydx - 
    \int_{0}^{1}\int_{0}^{y} \hat{u}_3(x,y,1-y)\,dxdy\right\}\,
    \tfrac{x}{1-z}.}
\end{IEEEeqnarray*}
In a completely similar fashion we arrive at
\begin{IEEEeqnarray*}{rCl}
  (\rku)_2(x,y,z) & = & y\,{\int_{\hat{E}} \dv\hat{\bu}\,d\hat{\boldsymbol{x}}}\,+
  \left\{{\iint_{\hat{f}_3} \hat\bu \cdot \hat\bn_3\,d\hat S} - 
   {\iint_{\hat{f}_4} \hat\bu \cdot \hat\bn_4\,d\hat S}\right\}\,\tfrac{y}{1-z}.\\[4pt]
               & = & y\,{\int_{\hat{E}} \dv\hat{\bu}\,d\hat{\boldsymbol{x}}}\,+\\[4pt]
  \IEEEeqnarraymulticol{3}{r}{
    \qquad\left\{\int_{0}^{1}\int_{0}^{x} \hat{u}_3(x,y,1-x)\,dydx - 
    \int_{0}^{1}\int_{0}^{y} \hat{u}_3(x,y,1-y)\,dxdy\right\}
    \tfrac{y}{1-z}.}
\end{IEEEeqnarray*}
We collect every term obtained so far for the first and second components in
Table~\ref{terms_table}.
\begin{table}[!h]
    \centering  
    \caption{Terms\\[4pt]$q(s,t) = \tfrac{2s-st}{1-t},\,r(s,t) = \tfrac{st}{1-t}$}
    \label{terms_table}
    \begin{IEEEeqnarraybox*}
    [\IEEEeqnarraystrutmode
    \IEEEeqnarraystrutsizeadd{2pt}{12pt}]{v/c/v/c/v/c/v/}
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
        & & & (\rku)_1 & & (\rku)_2 & \\
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
        & (\hat{u}_1,0,0)' & &
          \begin{IEEEeqnarraybox*}{l}
            -2{\iint_{\hat{f}_2} \hat{\bu} \cdot \hat\bn_2\,d\hat S}\\ + 
            {q(x,z)\int_{\hat{E}} \dv\hat{\bu} \,d\hat{\boldsymbol{x}}}
          \end{IEEEeqnarraybox*}
        & &
          -r(y,z){\int_{\hat{E}} \dv\hat{\bu} \,d\hat{\boldsymbol{x}}} &\\
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
        & (0,\hat{u}_2,0)' & & 
          -r(x,z){\int_{\hat{E}} \dv\hat{\bu} \,d\hat{\boldsymbol{x}}} 
        & & 
          \begin{IEEEeqnarraybox*}{l}
            -2{\iint_{\hat{f}_1} \hat{\bu} \cdot \hat\bn_1\,d\hat S}\\ + 
            {q(x,z)\int_{\hat{E}} \dv\hat{\bu} \,d\hat{\boldsymbol{x}}}
          \end{IEEEeqnarraybox*}
        &\\
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
        & (0,0,\hat{u}_3)' & & 
          \begin{IEEEeqnarraybox*}{l}
            x\int_{\hat{E}} \dv\hat{\bu}\,d\hat{\boldsymbol{x}} \\[5pt] +\, 
            \left\{\iint_{\hat{f}_3} \hat\bu \cdot \hat\bn_3\,d\hat S\right.
             \\[5pt] 
            \left. -\iint_{\hat{f}_4} \hat\bu \cdot \hat\bn_4\,d\hat S\right\}r(x,z)
          \end{IEEEeqnarraybox*}
         & & 
          \begin{IEEEeqnarraybox*}{l}
            y\int_{\hat{E}} \dv\hat{\bu}\,d\hat{\boldsymbol{x}}\\[5pt] +\, 
              \left\{\iint_{\hat{f}_4} \hat\bu \cdot \hat\bn_4\,d\hat S\right.
             \\[5pt] 
             \left.-\iint_{\hat{f}_3} \hat\bu \cdot \hat\bn_3\,d\hat S\right\}r(y,z)
          \end{IEEEeqnarraybox*}
        &\\\IEEEeqnarrayrulerow
    \end{IEEEeqnarraybox*}
\end{table}

Lastly, the third component of $\rku$ can be treated at once for any 
field $\hat\bu$ as follows:
\begin{IEEEeqnarray*}{rCl}
    (\rku)_3(x,y,z) & = &   z\sum_{i=1}^4\iint_{\hat{f}_i} \hat{\bu}\cdot\hat{\bn}_i\,d\hat S
                      + (z-1) \iint_{\hat{f}_5}\hat{\bu}\cdot\hat{\bn}_5\,d\hat S\\[5pt]
                    & = & z\iint_{\partial\hat{E}} \hat{\bu}\cdot\hat{\bn} - \iint_{f_5}
                 \hat{\bu}\cdot\hat{\bn}_5\,d\hat S\\[5pt]
    \yesnumber\label{term_rk3}
                    & = &\hat{x}_3\int_{\hat{E}} \mbox{div}\,\hat{\bu}\,d\hat{\bx} 
     + \iint_{\hat{f}_5} \hat{u}_3\,d\hat{S}.
\end{IEEEeqnarray*}
Now we bound each term in Table~\ref{terms_table} and in expression~(\ref{term_rk3}).
\begin{IEEEeqnarray*}{rCl}
  (\rku)_1 & = & (\br_{\hat{E}}(\hat{u}_1,0,0)')_1 + 
                 (\br_{\hat{E}}(0,\hat{u}_2,0)')_1 + 
                 (\br_{\hat{E}}(0,0,\hat{u}_3)')_1\\[5pt]
           & = & -2\iint_{\hat{f}_2}\hat{u}_1\,d\hat S +
  \tfrac{2x}{1-z}\int_{\hat{E}} \tfrac{\partial\hat{u}_1}{\partial\hat{x}_1}\,d\hat{\bx} -
  \tfrac{xz}{1-z}\int_{\hat{E}} \tfrac{\partial\hat{u}_1}{\partial\hat{x}_1}\,d\hat{\bx} \\[5pt]
  & & \,- \tfrac{xz}{1-z}\int_{\hat{E}} \tfrac{\partial\hat{u}_2}{\partial\hat{x}_2}\,d\hat{\bx}
  + \left( x + \tfrac{xz}{1-z}-\tfrac{xz}{1-z} \right)
  \int_{\hat{E}} \tfrac{\partial\hat{u}_3}{\partial\hat{x}_3}\,d\hat{\bx}\\[5pt]
  &   &\, + \left({\iint_{\hat{f}_3} \hat{u}_3\,d\hat S}
        - {\iint_{\hat{f}_4} \hat{u}_3\,d\hat S}\right)\tfrac{xz}{1-z}\\[5pt]
           & = & -2\iint_{\hat{f}_2}\hat{u}_1\,d\hat S +
  \tfrac{2x}{1-z}\int_{\hat{E}}\tfrac{\partial\hat{u}_1}{\partial\hat{x}_1}\,d\hat{\bx} -
  \tfrac{xz}{1-z}\int_{\hat{E}}\dv\hat{\bu}\,d\hat{\bx}\\[5pt]
  \yesnumber\label{face_integrals}
  &  & \,+\tfrac{x}{1-z}\int_{\hat{E}}\tfrac{\partial\hat{u}_3}{\partial\hat{x}_3}\,d\hat{\bx}
  + \left({\iint_{\hat{f}_3} \hat{u}_3\,d\hat S}
        - {\iint_{\hat{f}_4} \hat{u}_3\,d\hat S}\right)\tfrac{xz}{1-z}.
\end{IEEEeqnarray*}
For the surface integrals in~(\ref{face_integrals}), by Lemma 5.15 in~\cite{monk}, page 120,
\begin{IEEEeqnarray*}{rCl}
\left|\iint_{\hat{f}_2} \hat{u}_1\,d\hat S\right| 
  & \leqslant & C\,\|\hat{u}_1\|_{H^{1}(\hat{E})}
\end{IEEEeqnarray*}
and similarly
\begin{IEEEeqnarray*}{rCl}
  \left|\iint_{\hat{f}_3} \hat{u}_3\,d\hat S - \iint_{\hat{f}_4} \hat{u}_3\,d\hat S\right| 
  & \leqslant & C\,\|\hat{u}_3\|_{H^{1}(\hat{E})}
\end{IEEEeqnarray*}
all of which leads to
\begin{IEEEeqnarray*}{rCl}
  \|(\rku)_1\|_{L^{\infty}(\hat{E})} & \leqslant & C_{\hat{E}} 
  \left[ 
    \|\hat{u}_1\|_{H^{1}(\hat{E})} + 
    \|\dv\hat{\bu}\|_{L^{2}(\hat{E})} + 
    \|\hat{u}_3\|_{H^{1}(\hat{E})}
  \right].
\end{IEEEeqnarray*}
Copying the argument for the second component
\begin{IEEEeqnarray*}{rCl}
  \|(\rku)_2\|_{L^{\infty}(\hat{E})} & \leqslant & C_{\hat{E}} 
  \left[ 
    \|\hat{u}_2\|_{H^{1}(\hat{E})} + 
    \|\dv\hat{\bu}\|_{L^{2}(\hat{E})} + 
    \|\hat{u}_3\|_{H^{1}(\hat{E})}
  \right].
\end{IEEEeqnarray*}
Finally from~(\ref{term_rk3}) we deduce
\begin{IEEEeqnarray*}{rCl}
  \|(\rku)_3\|_{\scriptscriptstyle{L^\infty(\hat{E})}} & \leqslant & C_{\hat{E}}
    \left[\|\hat u_3\|_{\scriptscriptstyle{H^{1}(\hat{E})}} +
    \|\dv \hat\bu\|_{\scriptscriptstyle{L^2}(\hat{E})}\right].
\end{IEEEeqnarray*}
The quantity $C_{\hat{E}}$ depends only on the supremum of the (fixed)
basis shape functions of Table~\ref{shape_face_table} over the pyramid.
\end{proof}
% subsection face_elements (end)

%% ============================================================================
%% TODO: ver si esto finalmente va
%% \subsection{Local Interpolation Estimates for Pyramidal Finite Elements} % (fold)
%% \label{sub:local_interpolation_estimates_for_pyramidal_elements}
%% decir que permitimos pirámides elongadas perpendicularmente a la base
%% $h_3\geqslant C\min\{h_1,h_2\}$
%% Verificar si es esto o $h3 >= max (h1, h2)$\\
%% poner tres dibujos con casos $h1=h2<h3$; $h1<h2<h3$; $h2<h1<h3$
% subsection local_interpolation_estimates_for_pyramidal_elements (end)
%% ============================================================================


% section pyramidal_finite_elements (end)