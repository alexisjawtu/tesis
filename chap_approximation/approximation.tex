\chapter{Approximation}
\section{Discrete Well posedness} % (fold)
\label{sec:well_posedness}
If we consider the following kernel
\begin{IEEEeqnarray*}{rCl}
  \mathcal K_h & = & \{\bv_h\in V_h: b(\bv_h,q)=0\,\,
                        \mbox{for all } q\in Q_h\} \\[4pt]
               & = & V_{\textit{h}}\cap\ker\dv
\end{IEEEeqnarray*}
then the {\color{red}previuos Lemma} implies the following Proposition.
\begin{proposition}
  $a_h$ is coercive over $\mathcal K_h$ and the coercivity constant
  depends only on the shape regularity of the pyramids of the mesh.
\end{proposition}
\begin{proposition} \label{cont} The local discrete bilinear form $a_h^E$ is continuous en $L^2(E)$, that is,
\[
a_h^E(\bu,\bv)\leqslant C \|\bu\|_{L^2(E)}\|\bv\|_{L^2(E)}, \qquad \forall \bu,\bv\in V_h(E),
\]
where $C$ equals $1$ when $E$ is a right prism or tetrahedron, and depends only on the aspect ratio of $E$ in the case of pyramids.
\end{proposition}
\begin{proof}
When $E$ is a prism or tetrahedron, $a_h^E(\bu,\bv)=a^E(\bu,\bv)$ for $\bu$ and $\bv$ in $V_h(E)$, and the result is clear from the definition of $a^E$. When $E$ is a pyramid, we observe that $a_h^E$ is symmetric and coercive in $L^2(E)$ because of \eqref{L2}, and then it defines an inner product. Hence, from Cauchy-Schwarz inequality and again \eqref{L2} we have
\begin{multline*}
\left|a_h^E(\bu,\bv)\right|\leqslant a_h^E(\bu,\bu)^\frac12 a_h^E(\bv,\bv)^\frac12 \le\\ C_E a^E(\bu,\bu)^\frac12 a^E(\bv,\bv)^\frac12 \leqslant C_E\|\bu\|_{L^2(E)}\|\bv\|_{L^2(E)}.
\end{multline*}
The constant $C_E$ depends on the aspect ratio of $E$. This concludes the proof.
\end{proof}
\begin{lemma} \label{lemma_inf_sup_bh} There exists a constant
$\beta^*>0$ depending only on $\Omega$ {\color{brown} and the maximum aspect
ratio of the pyramids of $\Th$ (is this necessary?)}
such that for all $q^*\in Q_h$ there exists $\bw_h^*\in V_h$ such
that
\[
\dv\bw_h^*=q^* \mbox{\quad and\quad} \beta^*\|\bw_h^*\|_{Q}\leqslant\|q^*\|_{Q}.
\]
\end{lemma}
\begin{proof} Start considering the infinite dimensional version
of the statement. There is, in fact, a constant $\beta^*$ depending only on
$\Omega$ such that
for every $q^*\in Q_h \subseteq Q$ there exists 
$\bw^*\in H^1_0(\Omega)^3$ with $\dv\bw^*=q^*$ such that
\begin{IEEEeqnarray}{rCl} \label{bound_w}
  \beta^*\|\bw^*\|_{H^1(\Omega)} & \leqslant &
  \|q^*\|_{Q}.
\end{IEEEeqnarray}
Now, for each $q^*\in Q_h$ take {\color{red} poner que wh* se define
como una funcion partida, porque Corollary~\ref{interpolant} es local; 
queda mal si no.}$\bw_h^*:=I\bw^*$ as defined in
Corollary~\ref{interpolant}. As a consequence of Proposition~\ref{vem_equal_fem}
and because we are considering the exact same degrees of freedom, this
interpolation operator coincides, in the lowest order case, with the
$H(\dv)$--conforming operators~(\ref{sub:definition_of_the_h_div_element_on_prisms})
on prisms and~(\ref{sub:definition_of_the_h_div_element_on_tetrahedra}) on tetrahedra,
respectively. For prismatic elements we use the estimate in~(\ref{estabLp}), which is the 
analog of the statement in Theorem $3.1$ in page $149$ of~\cite{aadl}.
In the case of a pyramidal element we draw upon estimate~(\ref{estab2}). With
all these together and~(\ref{bound_w}) for all cases we get
\[
  \|\bw_{\textit{h}}^*\|_{Q} =
  \|I\bw^*\|_{Q}\leqslant
  C(1+\textit{h})\|\bw^*\|_{H^1(\Omega)}
  \leqslant\frac{C(1+\textit{h})}{\beta^*}\|q^*\|_{Q}.
\]
Besides, since $q^*\in Q_h$, by~(\ref{p0_projection}) we have
\[
  \dv I\bw^*=P_0\,\dv\bw^*=P_0\,q^*=q^*.
\]
\end{proof}
Now we can prove the discrete inf-sup condition. 
\begin{theorem}[Discrete $\inf-\sup$ condition for $b_h$] \label{inf_sup_b_h}
There exists $\beta > 0$ such that for all $q^*\in Q_h$ 
\begin{IEEEeqnarray*}{rCl}
  \sup_{0\ne\bv\in V_h} \frac{b_h(\bv,q^*)}{\|\bv\|_{V_h}} &\geqslant& \beta\|q^*\|_{Q_h}.
\end{IEEEeqnarray*}
\end{theorem}
\begin{proof} By Lemma~\ref{lemma_inf_sup_bh} for $q^*\in Q_h$
there exists $\bw_h^*\in V_h$ such that $\dv\bw_h^*=q^*$ and
$\beta^*\|\bw_h^*\|_{L^2(\Omega)}\leqslant\|q^*\|_{Q_h}$ (the constant $\beta^*$
is independent of $q^*$). Then
\begin{IEEEeqnarray*}{rcCcl}
  \|\bw_h^*\|_{V_h}^2 \, & \, = \, & \, \|\bw_h^*\|_{L^2(\Omega)}^2 + \|q^*\|_{Q_h}^2 
    \, & \,\leqslant\, & \, \left(\frac1{(\beta^*)^2}+1\right) \|q^*\|_{Q_h}^2
\end{IEEEeqnarray*}
and
\begin{IEEEeqnarray*}{rcCcl}
\sup_{0\ne\bv\in V_h} \frac{b_h(\bv,q^*)}{\|\bv\|_{V_h}}
      \,&\,\geqslant\,&\,
\frac{b_h(\bw_h^*,q^*)}{\|\bw_h^*\|_{V_h}}
      \,&\,\geqslant\,&\,
\frac1{\sqrt{\dfrac1{(\beta^*)^2}+1}}\,\|q^*\|_{Q_h}.
\end{IEEEeqnarray*}
\end{proof}
\begin{theorem} Problem~(\ref{mixedDiscrete}) has a unique solution
\end{theorem}
% section well_posedness (end)
\section{approximation} % (fold)
\label{sec:approximation}

\begin{theorem} solution $(\bu_{\textit{h}},p_{\textit{h}})$
to~(\ref{mixedDiscrete}) satisfies,
for every approximation $\pi(\bu)$ of $\bu$ in
$\hat V(\mathcal{T}_{\textit{h}})$,
  \begin{IEEEeqnarray*}{rCl}
    \|\bu-\bu_h\|_{L^2(\Omega)^3} &\leqslant& C\{\|\bu-I(\bu)\|_{L^2(\Omega)^3} + \|\bu-\pi(\bu)\|_{L^2(\Omega)^3}\} \\[5pt]
    \|P_{0,{\tau_{\textit{h}}}}p-p_h\|_{L^2(\Omega )} &\leqslant& C\{\|\bu-\bu_h\|_{L^2(\Omega)^3} + \|\bu-\pi(\bu)\|_{L^2(\Omega)^3}\}
  \end{IEEEeqnarray*} 
\end{theorem}
\begin{proof}
\end{proof}

{\color{brown}
esta version de intercalado se usa??
\begin{proof}
\begin{IEEEeqnarray*}{lCl}
  \|\boldsymbol{u} - \boldsymbol{u}_{\textit{h}}\|_{L^2(\Omega)^3}
  &\leqslant& 
  C\,\inf_{v\in\mathbb{V}_h}\|\boldsymbol{u} - \textbf{v}\|_{\mathbb{V}}\\[7pt]
  &\leqslant& 
  C\,\|\boldsymbol{u} - \pi\boldsymbol{u}\|_{\mathbb{V}}\\[10pt]
  \|p-p_{\textit{h}}\|_{\mathbb{Q}} &\leqslant&
  C\,[\inf_{v\in\mathbb{V}_h}\|\boldsymbol{u} - \textbf{v}\|_{\mathbb{V}}+
    \inf_{q\in\mathbb{Q}_h}\|p - q\|_{\mathbb{Q}}]\\
    &\leqslant&
  C\,[\|\boldsymbol{u} - \pi\boldsymbol{u}\|_{\mathbb{V}}+\|p - \pi_{\textit{h}}^{\bot} p \|_{\mathbb{Q}}].
\end{IEEEeqnarray*}
\end{proof}

}

If $\Omega$ were convex and $f\in L^2(\Omega)$ we know that the solution $p$ of
problem $H^2(\Omega)$, and so $\bu\in H^1(\Omega)^3$. In this case, using the 
interpolation error estimates we proved in Propositions 
\ref{propErrorInterpolacionPrismas} and 
\eqref{propErrorInterpolacionPiramidesTetraedros}, the result of 
Proposition \ref{propupi}, and a standard estimate for $L^2$-projection error, 
we obtain from Theorem \ref{estimacionError} the following Corollary.

\begin{corollary}
\begin{eqnarray*}
\|\bu-\bu_h\|_{L^2(\Omega)}&\leqslant& C\textit{h}|p|_{H^2(\Omega)}\\ 
\|p-p_h\|_{L^2(\Omega)}&\leqslant& C\textit{h}|p|_{H^1(\Omega)}
\end{eqnarray*}
where the constant $C$ depends only on the aspect ratios of tetrahedra 
and pyramids and the triangular bases of the right prisms on the mesh. 
\end{corollary}

Arbitrarily narrow right prisms can be used in the mesh without 
affecting this estimate. This fact can be further exploited when the
domain $\Omega$ is not convex or $f$ is not in $L^2(\Omega)$. This is what follows!

\begin{theorem}
There exists a family of anisotropic graded meshes
$\{\mathcal{T}_{\textit{h}}\}_{{\textit{h}}\downarrow 0}\,$
made up of
Prisms, tetrahedra and pyramids 
for which 
\begin{IEEEeqnarray*}{rCl}
  \|\bu-\bu_{\textit{h}}\|_{0,\Omega}&\leqslant &C {\textit{h}} \|f\|_{0,\Omega}\\[5pt]
  \|p-p_{\textit{h}}\|_{0,\Omega}&\leqslant &C \textit{h} \|f\|_{0,\Omega}
\end{IEEEeqnarray*}
whith $\textit{h}$ being smaller than  $C N^{\nicefrac{-1}{3}}$, where
$N = N_{\textit{h}}$ is the  number of elements in $\mathcal{T}_{\textit{h}}$.
\end{theorem}

%%=========== GRADING ==============================================
\begin{IEEEeqnarray*}{lCl}
  h_1, h_2 &\sim&
    \begin{cases}
      \textit{h}^{\frac{1}{\mu}}  & \text{ if\, }d(K,e)=0\\
      \textit{h}\,d(K,e)^{1-\mu}  & \text{ if\, }0<d(K,e)\lesssim1\\
      \textit{h}          & \text{ if\, }d(K,e)\sim1
    \end{cases}\\[5pt]
  h_3   &\sim& 
    \begin{cases}
      \textit{h}^{\frac{1}{\nu}}  & \text{ if\, }d(K,v)=0\\
      \textit{h}\,d(K,v)^{1-\nu}  & \text{ if\, }0<d(K,v)\lesssim1\\
      \textit{h}          & \text{ if\, }d(K,v)\sim1
    \end{cases}
\end{IEEEeqnarray*}
%%==================================================================
{\color{violet} $\mu \sim 1 - \delta$},\\
{\color{violet} $\nu \sim 1 - \beta$}\\

\textbf{Obs}: si $\delta(\Lambda)>1$ entonces
\[
  R_K(\textbf{x}) \leqslant \delta(\Lambda)\min\{ R_K(\textbf{x}), 1\}
\]
as\'i que asumimos $R_K(\textbf{x})\leqslant 1$.\\[7pt]
\textbf{Obs}: $\mu < 1 \Rightarrow \mu \leqslant \nu$. \\[7pt]



\section{Meshes}\label{meshes}
\subsection{Macroelement with singular edge and vertex}\label{caso4}
Let $T$ be a tetrahedral macroelement with vertices $P_0, P_1, P_2$ and $P_3$. We suppose that $P_0$ is the singular vertex and that the
singular edge is $P_0P_1$. The mesh $\mathcal T_h$ on $T$ will contain tetrahedra, prisms and pyramids. Now we describe those elements in terms
of the barycentric coordinates of the vertices of each element corresponding to the ordered vertices $P_0, P_1, P_2$ and $P_3$.
\bigskip

\underline{Prisms}

For 
\[
0\le l\le n-2 \qquad\mbox{and}\qquad i+j\le n-l-2
\]

\begin{tabular}{|c|c|c|c|c|}
\hline $p_0$  &  $1-\left(\frac{n-l}n\right)^\gamma$  &  $\left(\frac{n-l}n\right)^\gamma-\left(\frac{i+j}n\right)^\gamma$  &  $\frac in \left(\frac{i+j}n\right)^{\gamma-1}$  &  $\frac jn \left(\frac{i+j}n\right)^{\gamma-1}$\\
\hline $p_1$  &  $1-\left(\frac{n-l}n\right)^\gamma$  &  $\left(\frac{n-l}n\right)^\gamma-\left(\frac{i+j+1}n\right)^\gamma$  &  $\frac{i+1}n \left(\frac{i+1+j}n\right)^{\gamma-1}$  &  $\frac jn \left(\frac{i+1+j}n\right)^{\gamma-1}$\\
\hline $p_2$  &  $1-\left(\frac{n-l}n\right)^\gamma$  &  $\left(\frac{n-l}n\right)^\gamma-\left(\frac{i+j+1}n\right)^\gamma$  &  $\frac in \left(\frac{i+j+1}n\right)^{\gamma-1}$  &  $\frac{j+1}n \left(\frac{i+1+j}n\right)^{\gamma-1}$\\
\hline $p_3$  &  $1-\left(\frac{n-l-1}n\right)^\gamma$  &  $\left(\frac{n-l-1}n\right)^\gamma-\left(\frac{i+j}n\right)^\gamma$  &  $\frac in \left(\frac{i+j}n\right)^{\gamma-1}$  &  $\frac jn \left(\frac{i+j}n\right)^{\gamma-1}$\\
\hline $p_4$  &  $1-\left(\frac{n-l-1}n\right)^\gamma$  &  $\left(\frac{n-l-1}n\right)^\gamma-\left(\frac{i+1+j}n\right)^\gamma$  &  $\frac{i+1}n \left(\frac{i+1+j}n\right)^{\gamma-1}$  &  $\frac jn \left(\frac{i+1+j}n\right)^{\gamma-1}$\\
\hline $p_5$  &  $1-\left(\frac{n-l-1}n\right)^\gamma$  &  $\left(\frac{n-l-1}n\right)^\gamma-\left(\frac{i+j+1}n\right)^\gamma$  &  $\frac in \left(\frac{i+j+1}n\right)^{\gamma-1}$  &  $\frac{j+1}n \left(\frac{i+1+j}n\right)^{\gamma-1}$\\
\hline
\end{tabular}\medskip

and for 
\[
0\le l\le n-2,\qquad
i\ge1, \qquad \mbox{and}\qquad i+j\le n-l-2
\]

\begin{tabular}{|c|c|c|c|c|}
\hline $p_0$  &  $1-\left(\frac{n-l}n\right)^\gamma$  &  $\left(\frac{n-l}n\right)^\gamma-\left(\frac{i+j}n\right)^\gamma$  &  $\frac in \left(\frac{i+j}n\right)^{\gamma-1}$  &  $\frac jn \left(\frac{i+j}n\right)^{\gamma-1}$\\
\hline $p_1$  &  $1-\left(\frac{n-l}n\right)^\gamma$  &  $\left(\frac{n-l}n\right)^\gamma-\left(\frac{i+j+1}n\right)^\gamma$  &  $\frac in \left(\frac{i+j+1}n\right)^{\gamma-1}$  &  $\frac{j+1}n \left(\frac{i+j+1}n\right)^{\gamma-1}$\\
\hline $p_2$  &  $1-\left(\frac{n-l}n\right)^\gamma$   &  $\left(\frac{n-l}n\right)^\gamma-\left(\frac{i+j}n\right)^\gamma$  &  $\frac{i-1}n \left(\frac{i+j}n\right)^{\gamma-1}$  &  $\frac{j+1}n \left(\frac{i+j}n\right)^{\gamma-1}$\\
\hline $p_3$  &  $1-\left(\frac{n-l-1}n\right)^\gamma$  &  $\left(\frac{n-l-1}n\right)^\gamma-\left(\frac{i+j}n\right)^\gamma$  &  $\frac in \left(\frac{i+j}n\right)^{\gamma-1}$  &  $\frac jn \left(\frac{i+j}n\right)^{\gamma-1}$\\
\hline $p_4$  &  $1-\left(\frac{n-l-1}n\right)^\gamma$  &  $\left(\frac{n-l-1}n\right)^\gamma-\left(\frac{i+j+1}n\right)^\gamma$  &  $\frac in \left(\frac{i+j+1}n\right)^{\gamma-1}$  &  $\frac{j+1}n \left(\frac{i+j+1}n\right)^{\gamma-1}$\\
\hline $p_5$  &  $1-\left(\frac{n-l-1}n\right)^\gamma$  &  $\left(\frac{n-l-1}n\right)^\gamma-\left(\frac{i+j}n\right)^\gamma$  &  $\frac{i-1}n \left(\frac{i+j}n\right)^{\gamma-1}$  &  $\frac{j+1}n \left(\frac{i+j}n\right)^{\gamma-1}$\\
\hline
\end{tabular}
\bigskip

\underline{Pyramids}

For 
\[
0\le l\le n-2 \qquad\mbox{and}\qquad 1\le i\le n-l-1
\]

\begin{tabular}{|c|c|c|c|c|}
\hline $p_0$  &  $1-\left(\frac{n-l}n\right)^\gamma$   &  $\left(\frac{n-l}n\right)^\gamma-\left(\frac{n-l-1}n\right)^\gamma$   &  $\frac in \left(\frac{n-l-1}n\right)^{\gamma-1}$   &  $\frac{n-l-i-1}n \left(\frac{n-l-1}n\right)^{\gamma-1}$\\
\hline $p_1$  &  $1-\left(\frac{n-l}n\right)^\gamma$   &  $\left(\frac{n-l}n\right)^\gamma-\left(\frac{n-l-1}n\right)^\gamma$   &  $\frac{i-1}n \left(\frac{n-l-1}n\right)^{\gamma-1}$   &  $\frac{n-l-i}n \left(\frac{n-l-1}n\right)^{\gamma-1}$\\
\hline $p_2$  &  $1-\left(\frac{n-l-1}n\right)^\gamma$   &  $0$   &  $\frac in \left(\frac{n-l-1}n\right)^{\gamma-1}$   &  $\frac{n-l-i-1}n \left(\frac{n-l-1}n\right)^{\gamma-1}$\\
\hline $p_3$  &  $1-\left(\frac{n-l-1}n\right)^\gamma$   &  $0$   &  $\frac{i-1}n \left(\frac{n-l-1}n\right)^{\gamma-1}$   &  $\frac{n-l-i}n \left(\frac{n-l-1}n\right)^{\gamma-1}$\\
\hline $p_4$  &  $1-\left(\frac{n-l}n\right)^\gamma$   &  $0$   &  $\frac in \left(\frac{n-l}n\right)^{\gamma-1}$   &  $ \frac{n-l-i}n \left(\frac{n-l}n\right)^{\gamma-1}$\\
\hline
\end{tabular}
\bigskip 

\underline{Tetrahedra}

For 
\[
0\le l\le n-1\qquad\mbox{and}\qquad 1\le i\le n-l-1
\]

\begin{tabular}{|c|c|c|c|c|}
\hline $p_0$  &  $1-\left(\frac{n-l}n\right)^\gamma$   &  $\left(\frac{n-l}n\right)^\gamma-\left(\frac{n-l-1}n\right)^\gamma$   &  $\frac in \left(\frac{n-l-1}n\right)^{\gamma-1}$   &  $\frac{n-l-i-1}n \left(\frac{n-l-1}n\right)^{\gamma-1}$\\ 
\hline $p_1$  &  $1-\left(\frac{n-l-1}n\right)^\gamma$   &  $0$   &  $\frac in \left(\frac{n-l-1}n\right)^{\gamma-1}$   &  $\frac{n-l-i-1}n \left(\frac{n-l-1}n\right)^{\gamma-1}$\\
\hline $p_2$  &  $1-\left(\frac{n-l}n\right)^\gamma$   &  $0$   &  $\frac in \left(\frac{n-l}n\right)^{\gamma-1}$   &  $\frac{n-l-i}n \left(\frac{n-l}n\right)^{\gamma-1}$\\
\hline $p_3$  &  $1-\left(\frac{n-l}n\right)^\gamma$   &  $0$   &  $\frac{i+1}n \left(\frac{n-l}n\right)^{\gamma-1}$   &  $\frac{n-l-i-1}n \left(\frac{n-l}n\right)^{\gamma-1}$\\
\hline 
\end{tabular}\qquad
\begin{tabular}{c}

\end{tabular}
\bigskip

\subsection{Macroelement with a singular vertex}

We consider again a tetrahedral macroelement $T$ with vertices $P_0, P_1, P_2$ and $P_3$, assuming that it has a singular vertex at $P_0$ and no singular edge. We construct a triangulation of $T$ made of tetrahedra describing the barycentric coordinates of the vertices of each tetrahedron with respect to $P_0, P_1, P_2$ and $P_3$. This case corresponds to Case 1 of \cite{AN}.

Let $p_{i,j,k}$ be the points with barycentric coordinates
\begin{eqnarray*}
&&\lambda_0=1-\lambda_1-\lambda_2-\lambda_3,\\
&&\lambda_1=\frac in\left(\frac{i+j+k}n\right)^{\gamma-1},\quad \lambda_2=\frac jn\left(\frac{i+j+k}n\right)^{\gamma-1},\quad \lambda_3=\frac kn\left(\frac{i+j+k}n\right)^{\gamma-1},
\\ &&0\le i+j+k\le n.
\end{eqnarray*}
Then, the tetrahedra are the ones with vertices
\begin{eqnarray*}
&& p_{i,j,k}, p_{i+1,j,k}, p_{i,j+1,k}, p_{i,j,k+1}, \qquad 0\le i+j+k\le n-1\\
&& p_{i+1,j,k}, p_{i,j+1,k}, p_{i,j,k+1}, p_{i+1,j,k+1}, \qquad 0\le i+j+k\le n-2\\
&& p_{i,j+1,k}, p_{i,j,k+1}, p_{i+1,j,k+1}, p_{i,j+1,k+1}, \qquad 0\le i+j+k\le n-2\\
&& p_{i+1,j,k}, p_{i,j+1,k}, p_{i+1,j+1,k}, p_{i+1,j,k+1}, \qquad 0\le i+j+k\le n-2\\
&& p_{i,j+1,k}, p_{i+1,j+1,k}, p_{i+1,j,k+1}, p_{i,j+1,k+1}, \qquad 0\le i+j+k\le n-2\\
&& p_{i+1,j+1,k}, p_{i+1,j,k+1}, p_{i,j+1,k+1}, p_{i+1,j+1,k+1}, \qquad 0\le i+j+k\le n-3
\end{eqnarray*}


\begin{proposition} Pyramids and tetrahedra are isotropic.
\end{proposition}
\begin{proof} We deal firstly with pyramids. Consider a pyramid with vertices $p_0, \ldots, p_4$ in a macroelement of vertices $P_0,P_1,P_2$ and $P_3$ as in Subsection \ref{caso4}. Note that the basis of the pyramid is the paralelogram $p_0p_1p_3p_2$ with
\begin{eqnarray}\label{once}
&&p_1-p_0=p_3-p_2=\frac1n\left(\frac{n-l-1}n\right)^{\gamma-1}(P_3-P_2)\\\label{doce} &&p_2-p_0=p_3-p_1=\left[\left(\frac{n-l}n\right)^\gamma-\left(\frac{n-l-1}n\right)^\gamma\right](P_0-P_1).
\end{eqnarray}
So 
\[
\frac{\gamma}{n}\left(\frac{n-l-1}n\right)^{\gamma-1}|P_0-P_1|\le |p_2-p_0|=|p_3-p_1|\le \frac{\gamma}{n}\left(\frac{n-l}n\right)^{\gamma-1}|P_0-P_1|,
\]
and 
\[
\frac1\gamma\left(\frac12\right)^{\gamma-1}\le\frac1\gamma\left(\frac{n-l-1}{n-l}\right)^{\gamma-1}\le\frac{|p_1-p_0|}{|p_2-p_0|}\le \frac1\gamma.
\]
Then the parallelogram $p_0p_1p_3p_2$ is shape-regular since the angle between $P_0-P_1$ and $P_3-P_2$ depends only on the macroelement, and so it is away from $0$ and $\pi$. 

Now we prove that there exists constants $c_0$ and $c_1$ depending only on $\gamma$ and the macroelement's vertices such that
\begin{eqnarray}\label{diez}
&c_0\le\frac{|p_4-p_2|}{|p_2-p_0|}\le c_1&\\ \label{trece}
&c_0\le\frac{|p_4-p_3|}{|p_2-p_0|}\le c_1&.
\end{eqnarray}
After simple computations we obtain
\begin{eqnarray*}
p_4-p_2 &=& \left[\left(\frac{n-l}n\right)^\gamma - \left(\frac{n-l-1}n\right)^\gamma\right](P_3-P_0) \\ &&\qquad + \frac in \left[\left(\frac{n-l}n\right)^{\gamma-1} - \left(\frac{n-l-1}n\right)^{\gamma-1}\right](P_2-P_3)\\ &=& \left[\left(\frac{n-l}n\right)^\gamma - \left(\frac{n-l-1}n\right)^\gamma\right]\bigg\{P_3-P_0 +\\ &&\qquad + \frac{\frac in \left[\left(\frac{n-l}n\right)^{\gamma-1} - \left(\frac{n-l-1}n\right)^{\gamma-1}\right]}{\left[\left(\frac{n-l}n\right)^\gamma - \left(\frac{n-l-1}n\right)^\gamma\right]} (P_2-P_3)\bigg\}\\ &\sim& \left[\left(\frac{n-l}n\right)^\gamma - \left(\frac{n-l-1}n\right)^\gamma\right](P_3-P_0)\\ &\sim& p_3-p_1
\end{eqnarray*}
where we used that 
\[
\frac{\frac in \left[\left(\frac{n-l}n\right)^{\gamma-1} - \left(\frac{n-l-1}n\right)^{\gamma-1}\right]}{\left[\left(\frac{n-l}n\right)^\gamma - \left(\frac{n-l-1}n\right)^\gamma\right]}\le \frac{\gamma-1}{\gamma},
\]
that the angle between $P_3-P_0$ and $P_2-P_3$ is fixed (and depends only on the macroelement) and equation \eqref{doce}. This prove \eqref{diez}, and \eqref{trece} follows analogously. In order to prove that the pyramid is isotropic now we have to note that the basis $p_0p_1p_3p_2$ is contained in a plane parallel to the one generated by the vectors $P_1-P_0$ and $P_3-P_2$, and the face $p_2p_3p_4$ is in a plane parallel to the plane (macroelement's face) $P_0P_2P_3$, and the angle between those planes depends only on the macroelement.      


COMPLETAR PRUEBA PARA LOS TETRAEDROS
\end{proof}



Another way, less formal but clearer, to look
at the  mesh points in a tetrahedral macroelement
with both kinds of singularities is the following.

Fijamos:
\begin{IEEEeqnarray*}{rCl}
  T &=& \left[\textbf{p}_0,\textbf{p}_1,\textbf{p}_2,\textbf{p}_3\right]\\[7pt]
  \textbf{p}_0 &=& 0\\[7pt]
  \left[\textbf{p}_0,\textbf{p}_3\right] &=& 
  \text{la arista singular}\\[7pt]
  \textbf{p}_3 & = & \text{v\'ertice singular}\\[7pt]
  \left[\textbf{p}_0, \textbf{p}_1, 
  \textbf{p}_2\right]&\subseteq&\{z=0\}.
\end{IEEEeqnarray*}
  
$\lambda_0,\lambda_1$ y $\lambda_2$: {\color{RedOrange}coordenadas  baric\'entricas} con respecto a
$\textbf{p}_0,\textbf{p}_1$ y $\textbf{p}_2$.\\[10pt]
$\textbf{p}_{i,j}$ es tal que\\[5pt]
\begin{IEEEeqnarray*}{rCl}
  \lambda_0(\textbf{p}_{i,j}) &=& 1-\lambda_1(\textbf{p}_{i,j}) - \lambda_2(\textbf{p}_{i,j}) \\[5pt]
  \lambda_1(\textbf{p}_{i,j})  &=& \frac{i}{n}\left(\frac{i+j}{n}\right)^{\frac{1}{\mu}-1}\\[5pt]
  \lambda_2(\textbf{p}_{i,j})  &=& \frac{j}{n}\left(\frac{i+j}{n}\right)^{\frac{1}{\mu}-1}.\\[15pt]
  &&0\leqslant i\leqslant n\\[5pt]
  &&0\leqslant j\leqslant n-i
\end{IEEEeqnarray*}
  
Los puntos son la uni\'on de\\[5pt]
\begin{IEEEeqnarray*}{lCl}
  \left\{ \textbf{p}_{i,j}\,:\,0\leqslant i\leqslant n,\quad
    0\leqslant j\leqslant n-i \right\}&&\\[7pt]
  \left\{ \textbf{p}_{i,j}\,:\,0\leqslant i\leqslant n-1,\quad
  0\leqslant j\leqslant n-1-i \right\} & \quad+\quad & 
  [{\scriptstyle 1-\left(\frac{n-1}{n}\right)^{1/\mu}}]\,\textbf{e}_3\\[7pt]
  \IEEEeqnarraymulticol{3}{c}{\vdots}\\[7pt]
  \left\{\textbf{p}_{i,j}\,:\,0\leqslant i\leqslant n-k,\quad
  0\leqslant j\leqslant n-k-i \right\} & \quad+\quad &
  [{\scriptstyle 1-\left(\frac{n-k}{n}\right)^{1/\mu}}]\,\textbf{e}_3\\[7pt]
  \IEEEeqnarraymulticol{3}{c}{\vdots}\\[7pt]
  \left\{ \textbf{p}_{i,j}\,:\,0\leqslant i\leqslant 1,\quad
  0\leqslant j\leqslant 1-i \right\} & \quad+\quad &
  [{\scriptstyle 1-\left(\frac{1}{n}\right)^{1/\mu}}]\,\textbf{e}_3\\[10pt]
  \IEEEeqnarraymulticol{3}{l}{\left\{\textbf{e}_3\right\}}\text{,}
\end{IEEEeqnarray*}
i.e.:
\begin{IEEEeqnarray*}{rCl}
  \mathcal{P} & = & \bigcup_{k=0}^n\;\left\{ \textbf{p}_{i,j}\,:\,0\leqslant i\leqslant n - k,\quad
  0\leqslant j\leqslant n-k-i \right\}\\[8pt]
  &&\quad+\,[{\scriptstyle1-\left(\frac{n-k}{n}\right)^{1/\mu}}]\,\textbf{e}_3.
\end{IEEEeqnarray*}

\section{main approximation theorem}
{\color{brown}The following table shows what has to be done for each type of
element.
\begin{table}
\centering
\caption{Parte singular.}
  \begin{IEEEeqnarraybox}
  [\IEEEeqnarraystrutmode
   \IEEEeqnarraystrutsizeadd{0pt}{0pt}]{v/c/v/c/v/c/v/c/v}
    \IEEEeqnarrayrulerow\\
    \IEEEeqnarrayseprow[3pt]\\
    &\hfill\raisebox{22pt}[0pt][0pt]{$d(K,\textbf{e})>0$}\hfill
                & & \referencePrismTikz 
              & & \referencePyramidTikz
                & & \referenceTetrahedronTikz &\\
    \IEEEeqnarrayrulerow\\
    \IEEEeqnarrayseprow[3pt]\\
    &\hfill\raisebox{30pt}[0pt][0pt]{$d(K,\textbf{e})=0$}\hfill& &
      \begin{IEEEeqnarraybox}{c}
      \referencePrismTikz\\d(K,\textbf{v}) > 0
      \end{IEEEeqnarraybox}
    &&&&
      \begin{IEEEeqnarraybox}{c}
        \referenceTetrahedronTikz\\d(K,\textbf{v}) = 0
      \end{IEEEeqnarraybox}
    &\\
    \IEEEeqnarrayseprow[3pt]\\
    \IEEEeqnarrayrulerow
  \end{IEEEeqnarraybox}
\end{table}
}
{\color{blue}\#\#\#\#\#\#\#\# meshing procedure and examples\\[5pt]}
{\color{blue}\#\#\#\#\#\#\#\# continue here. anisotropic estimates!\\[5pt]}
% section approximation (end)
