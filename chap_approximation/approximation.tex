\chapter{Approximation}
\section{regularity} % (fold)
\label{sec:regularity}
\begin{defi}
  If $\Omega$ is a non--convex polihedron $\lambda_e$ is ... and $\lambda_v$ is ---	
\end{defi}
\noindent Assuming a decomposition of $\Omega=\cup_{\ell=1}^N \Lambda_\ell$ in tetrahedral macroelements having at most a singular edge and a singular vertex, we have the following regularity result. First we introduce the space $V^{1,2}_{\beta,\delta}(\Lambda)$ for a macroelement $\Lambda$ as
\[
V^{1,2}_{\beta,\delta} = \left\{v\in \mathcal D'(\Lambda): R^{\beta-1+|\alpha|}\theta^{\delta-1+|\alpha|}D^\alpha v\in L^2(\Lambda), \alpha\in \mathbb N^3, |\alpha|\le1\right\}
\]
where $R({\bf x})$ is the distance of ${\bf x}$ to the vertices of $\Lambda$, $r({\bf x})$ is the distance from ${\bf x}$ to the edges of $\Lambda$ and finally $\theta({\bf x})$ is the angular distance $\theta({\bf x})=\frac{r({\bf x})}{R({\bf x})}$.
\begin{theorem}
The solutions $\bu$ and $p$ of problem \eqref{mixedContinuous} satisfy
\[
p\in H^1(\Omega)
\] 
and for each $\ell$
\[
\bu=\bu_r + \bu_s
\]
with $\bu_r\in H^1(\Omega)$ and
\[
\bu_s\cdot \xi_i\in V^{1,2}_{\beta,\delta}(\Lambda_\ell), \quad i=1,2, \qquad \bu_s\cdot\xi_3\in V^{1,2}_{\beta,0}(\Lambda_\ell)
\]
where $\xi_i$, $i=1,2,3$, are the directions of three concurrent edges of $\Lambda_\ell$ with $\xi_3$ being the direction of the singular edge if it exists in $\Omega_\ell$, and $\beta,\delta\ge0$ satisfying $\beta>\frac12-\lambda_v^{(\ell)}$ and $\delta>1-\lambda_e^{(\ell)}$, $v$ and $e$ being the singular vertex and edge, respectively, if they exist.
\end{theorem} 

\begin{remark}\label{sobreBetaYDelta}
\textcolor{red}{Note that it is always possible in the previous Theorem to take $0<\beta=\delta<1$.} 
\end{remark}


\section{Discrete Well posedness} % (fold)
\label{sec:well_posedness}
If we consider the following kernel
\begin{IEEEeqnarray*}{rCl}
  \mathcal K_h & = & \{\bv_h\in V_h: b(\bv_h,q)=0\,\,
                        \mbox{for all } q\in Q_h\} \\[4pt]
               & = & V_{\textit{h}}\cap\ker\dv
\end{IEEEeqnarray*}
then the {\color{red}previuos Lemma} implies the following Proposition.
\begin{proposition}
  $a_h$ is coercive over $\mathcal K_h$ and the coercivity constant
  depends only on the shape regularity of the pyramids of the mesh.
\end{proposition}
\begin{proposition} \label{cont} The local discrete bilinear form $a_h^E$ is continuous en $L^2(E)$, that is,
\[
a_h^E(\bu,\bv)\leqslant C \|\bu\|_{L^2(E)}\|\bv\|_{L^2(E)}, \qquad \forall \bu,\bv\in V_h(E),
\]
where $C$ equals $1$ when $E$ is a right prism or tetrahedron, and depends only on the aspect ratio of $E$ in the case of pyramids.
\end{proposition}
\begin{proof}
When $E$ is a prism or tetrahedron, $a_h^E(\bu,\bv)=a^E(\bu,\bv)$ for $\bu$ and $\bv$ in $V_h(E)$, and the result is clear from the definition of $a^E$. When $E$ is a pyramid, we observe that $a_h^E$ is symmetric and coercive in $L^2(E)$ because of \eqref{L2}, and then it defines an inner product. Hence, from Cauchy-Schwarz inequality and again \eqref{L2} we have
\begin{multline*}
\left|a_h^E(\bu,\bv)\right|\leqslant a_h^E(\bu,\bu)^\frac12 a_h^E(\bv,\bv)^\frac12 \le\\ C_E a^E(\bu,\bu)^\frac12 a^E(\bv,\bv)^\frac12 \leqslant C_E\|\bu\|_{L^2(E)}\|\bv\|_{L^2(E)}.
\end{multline*}
The constant $C_E$ depends on the aspect ratio of $E$. This concludes the proof.
\end{proof}
\begin{lemma} \label{lemma_inf_sup_bh} There exists a constant
$\beta^*>0$ depending only on $\Omega$ {\color{brown} and the maximum aspect
ratio of the pyramids of $\Th$ (is this necessary?)}
such that for all $q^*\in Q_h$ there exists $\bw_h^*\in V_h$ such
that
\[
\dv\bw_h^*=q^* \mbox{\quad and\quad} \beta^*\|\bw_h^*\|_{Q}\leqslant\|q^*\|_{Q}.
\]
\end{lemma}
\begin{proof} Start considering the infinite dimensional version
of the statement. There is, in fact, a constant $\beta^*$ depending only on
$\Omega$ such that
for every $q^*\in Q_h \subseteq Q$ there exists 
$\bw^*\in H^1_0(\Omega)^3$ with $\dv\bw^*=q^*$ such that
\begin{IEEEeqnarray}{rCl} \label{bound_w}
  \beta^*\|\bw^*\|_{H^1(\Omega)} & \leqslant &
  \|q^*\|_{Q}.
\end{IEEEeqnarray}
Now, for each $q^*\in Q_h$ take {\color{red} poner que wh* se define
como una funcion partida, porque Corollary~\ref{interpolant} es local; 
queda mal si no.}$\bw_h^*:=I\bw^*$ as defined in
Corollary~\ref{interpolant}. As a consequence of Proposition~\ref{vem_equal_fem}
and because we are considering the exact same degrees of freedom, this
interpolation operator coincides, in the lowest order case, with the
$H(\dv)$--conforming operators~(\ref{sub:definition_of_the_h_div_element_on_prisms})
on prisms and~(\ref{sub:definition_of_the_h_div_element_on_tetrahedra}) on tetrahedra,
respectively. For prismatic elements we use the estimate in~(\ref{estabLp}), which is the 
analog of the statement in Theorem $3.1$ in page $149$ of~\cite{aadl}.
In the case of a pyramidal element we draw upon estimate~(\ref{estab2}). With
all these together and~(\ref{bound_w}) for all cases we get
\[
  \|\bw_{\textit{h}}^*\|_{Q} =
  \|I\bw^*\|_{Q}\leqslant
  C(1+\textit{h})\|\bw^*\|_{H^1(\Omega)}
  \leqslant\frac{C(1+\textit{h})}{\beta^*}\|q^*\|_{Q}.
\]
Besides, since $q^*\in Q_h$, by~(\ref{p0_projection}) we have
\[
  \dv I\bw^*=P_0\,\dv\bw^*=P_0\,q^*=q^*.
\]
\end{proof}
Now we can prove the discrete inf-sup condition. 
\begin{theorem}[Discrete $\inf-\sup$ condition for $b_h$] \label{inf_sup_b_h}
There exists $\beta > 0$ such that for all $q^*\in Q_h$ 
\begin{IEEEeqnarray*}{rCl}
  \sup_{0\ne\bv\in V_h} \frac{b_h(\bv,q^*)}{\|\bv\|_{V_h}} &\geqslant& \beta\|q^*\|_{Q_h}.
\end{IEEEeqnarray*}
\end{theorem}
\begin{proof} By Lemma~\ref{lemma_inf_sup_bh} for $q^*\in Q_h$
there exists $\bw_h^*\in V_h$ such that $\dv\bw_h^*=q^*$ and
$\beta^*\|\bw_h^*\|_{L^2(\Omega)}\leqslant\|q^*\|_{Q_h}$ (the constant $\beta^*$
is independent of $q^*$). Then
\begin{IEEEeqnarray*}{rcCcl}
  \|\bw_h^*\|_{V_h}^2 \, & \, = \, & \, \|\bw_h^*\|_{L^2(\Omega)}^2 + \|q^*\|_{Q_h}^2 
    \, & \,\leqslant\, & \, \left(\frac1{(\beta^*)^2}+1\right) \|q^*\|_{Q_h}^2
\end{IEEEeqnarray*}
and
\begin{IEEEeqnarray*}{rcCcl}
\sup_{0\ne\bv\in V_h} \frac{b_h(\bv,q^*)}{\|\bv\|_{V_h}}
      \,&\,\geqslant\,&\,
\frac{b_h(\bw_h^*,q^*)}{\|\bw_h^*\|_{V_h}}
      \,&\,\geqslant\,&\,
\frac1{\sqrt{\dfrac1{(\beta^*)^2}+1}}\,\|q^*\|_{Q_h}.
\end{IEEEeqnarray*}
\end{proof}

% section well_posedness (end)

\begin{theorem} Problem~(\ref{mixedDiscrete}) has a unique solution
$(\bu_{\textit{h}},p_{\textit{h}})$ and
for every approximation $\pi(\bu)$ of $\bu$ in
$\hat V(\mathcal{T}_{\textit{h}})$ it holds
  \begin{IEEEeqnarray*}{rCl}
    \|\bu-\bu_h\|_{L^2(\Omega)^3} &\leqslant& C\{\|\bu-I(\bu)\|_{L^2(\Omega)^3} + \|\bu-\pi(\bu)\|_{L^2(\Omega)^3}\} \\[5pt]
    \|P_{0,{\tau_{\textit{h}}}}p-p_h\|_{L^2(\Omega )} &\leqslant& C\{\|\bu-\bu_h\|_{L^2(\Omega)^3} + \|\bu-\pi(\bu)\|_{L^2(\Omega)^3}\}
  \end{IEEEeqnarray*} 
\end{theorem}
\begin{proof}
\end{proof}

If $\Omega$ were convex and $f\in L^2(\Omega)$ we know that the solution $p$ of
problem $H^2(\Omega)$, and so $\bu\in H^1(\Omega)^3$. In this case, using the 
interpolation error estimates we proved in Propositions 
\ref{propErrorInterpolacionPrismas} and 
\eqref{propErrorInterpolacionPiramidesTetraedros}, the result of 
Proposition \ref{propupi}, and a standard estimate for $L^2$-projection error, 
we obtain from Theorem \ref{estimacionError} the following Corollary.

\begin{corollary}
\begin{eqnarray*}
\|\bu-\bu_h\|_{L^2(\Omega)}&\leqslant& C\textit{h}|p|_{H^2(\Omega)}\\ 
\|p-p_h\|_{L^2(\Omega)}&\leqslant& C\textit{h}|p|_{H^1(\Omega)}
\end{eqnarray*}
where the constant $C$ depends only on the aspect ratios of tetrahedra 
and pyramids and the triangular bases of the right prisms on the mesh. 
\end{corollary}

Arbitrarily narrow right prisms can be used in the mesh without 
affecting this estimate. This fact can be further exploited when the
domain $\Omega$ is not convex or $f$ is not in $L^2(\Omega)$. This is what follows!

{\color{blue}\#\#\#\#\#\#\#\# thms del final de la charla de sn3\\[5pt]}
{\color{blue}\#\#\#\#\#\#\#\# meshing procedure and examples\\[5pt]}
{\color{blue}\#\#\#\#\#\#\#\# continue here. anisotropic estimates!\\[5pt]}
