\chapter{Interpolation}
\section{Prismatic Finite Elements} % (fold)
\label{sec:prismatic_finite_elements}

\begin{table}[!h]
    \centering  
    \caption{Notation for the faces and positive normals of $\partial\hat{E}$.}
    \label{prismNotationTableFaces}
    \begin{IEEEeqnarraybox*}
      [\IEEEeqnarraystrutmode
      \IEEEeqnarraystrutsizeadd{2pt}{6pt}]{v/c/x/c/x/c/x/v/x/c/x/c/x/c/v/}
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
          & \hat f_1 && \subseteq &&  \{\hat x_1 = 0 \}            && && \hat{\bn}_1 && = && (-1,0,0)' & \\
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
          & \hat f_2 && \subseteq &&  \{\hat x_2 = 0 \}            && && \hat{\bn}_2 && = && (0,-1,0)' &\\
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
          & \hat f_3 && \subseteq &&  \{\hat x_3 = 0 \} && && \hat{\bn}_3 && = && (0,0,-1)' &\\
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
          & \hat f_4 && \subseteq &&  \{\hat x_3 = 1 \} && && \hat{\bn}_4 && = && (0,0,1)' &\\
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
          & \hat f_5 && \subseteq &&  \{\hat x_1+\hat x_2 = 1\} && && \hat{\bn}_5 && = && 2^{-\nicefrac{1}{2}}(1,1,0)' &\\
        \IEEEeqnarrayrulerow
    \end{IEEEeqnarraybox*}
\end{table}

\begin{table}[!h]
    \centering  
    \caption{Notation for the edges and positive tangents of $\partial\hat{E}$.
    {\color{red} chequear}}
    \label{prismNotationTableEdges}
    \begin{IEEEeqnarraybox*}
      [\IEEEeqnarraystrutmode
      \IEEEeqnarraystrutsizeadd{2pt}{6pt}]{v/c/x/c/x/c/x/v/x/c/x/c/x/c/v/}
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
   & \hat \be_1 && = && \{(\hat x_1,0,0)^t\,:\,0\leqslant\hat x_1\leqslant 1\} && && \hat \btau_1 && = && (1,0,0)' & \\
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
   & \hat \be_2 && = && \{(0,\hat x_2,0)^t\,:\,0\leqslant\hat x_2\leqslant 1\} && && \hat \btau_2 && = && (0,1,0)' & \\
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
   & \hat \be_3 && = && \{(0,0,\hat x_3)^t\,:\,0\leqslant\hat x_3\leqslant 1\} && && \hat \btau_3 && = && (0,0,1)' & \\
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
   & \hat \be_4 && = && \{(\hat x_1,0,1)^t\,:\,0\leqslant\hat x_1\leqslant 1\} && && \hat \btau_4 && = && (0,0,1)' & \\
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
   & \hat \be_5 && = && \{(0,\hat x_2,1)^t\,:\,0\leqslant\hat x_2\leqslant 1\} && && \hat \btau_5 && = && (0,0,1)' & \\
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
   & \hat \be_6 && = && \{(1,0,\hat x_3)^t\,:\,0\leqslant\hat x_3\leqslant 1\} && && \hat \btau_6 && = && (1,0,0)' & \\
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
   & \hat \be_7 && = && \{(0,1,\hat x_3)^t\,:\,0\leqslant\hat x_3\leqslant 1\} && && \hat \btau_7 && = && (0,1,0)' & \\
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
   & \hat \be_8 && = && \{(\hat x_1,1-\hat x_1,1)^t\,:\,0\leqslant\hat x_1\leqslant 1\} && && \hat \btau_8 && = && 2^{-\nicefrac{1}{2}}(1,-1,0)' & \\
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
   & \hat \be_9 && = && \{(\hat x_1,1-\hat x_1,0)^t\,:\,0\leqslant\hat x_1\leqslant 1\} && && \hat \btau_9 && = && 2^{-\nicefrac{1}{2}}(1,-1,0)' & \\
        \IEEEeqnarrayrulerow  
    \end{IEEEeqnarraybox*}
\end{table}
\begin{figure}[!h]
  \centering
  \subfloat
  {
    \label{unitTanPrism}
    \unitTangentsPrism
  }
  \caption{Directions of positive unit tangents (cfr. Table~\ref{prismNotationTableEdges}).}
\end{figure}
\subsection{Stability of curl--conforming Finite Element on Prisms}
\label{stab_edge_prism}
\input{./chap_interpolation/stability_edge_ref_prism}
\input{./chap_interpolation/stability_edge_tilde_prism}
\subsection{Stability of divergence--conforming Finite Elements on Prisms} % (fold)
The exposition in this section will be the $H(\mbox{div})$--conforming analogue
of the exposition in the previous section.\\
\noindent In present subsection $\hat\bu$ will be an element
of $W^{1,1}(\hat E)$ in which elements have well defined
normal traces over the faces of $\hat{E}$, another possibility
being, as mentioned in~\cite{monk}, Lemma $5.15$, page $120$, to assume
there is
a positive $\delta$ such that $\hat\bu$ belongs to
$H^{1/2+\delta}(\hat{E})^3$.
$\hat\br_k$ will be, for the whole subsection, the $k$--th order face 
interpolation operator on the reference
Prism determined by the element of
\emph{Definition}~\ref{defi_h_div_conforme}.
\label{stability_of_rt_element_in_hat_k}
\begin{lemma}\label{lemmaRT3zero}
$(\rku)_3$ is linearly and univocally determined by $\hat{u}_3$.
\end{lemma}
\begin{proof}
By the unisolvence of the Finite Element~(\ref{defi_h_div_conforme})
$(\rku)_3$ is determined by the following linear equations.
\begin{IEEEeqnarray}{rCrl}
\label{rku_3_1}
\rho_{f_j,q}\,(\rku) & = & \rho_{f_j,q}\,(\hat{\bu})
  &\quad\mbox{for $j$ = 3, 4 and }q\in\mathcal{P}_{\hat{f}_j} \\
\label{rku_3_2}
\rho_{\br}\,(\rku) & = & \rho_{\br}\,(\hat{\bu})
  &\quad\mbox{for }\br\in\mathcal{P}_{\hat{E}}\mbox{ with }r_1 = r_2 = 0.
\end{IEEEeqnarray}
We have $\nicefrac{k(k+1)^2}{2}$ equations, which is the 
number of independent coefficients in $(\rku)_3$.
Now set $u_3 = 0$, which makes the right hand side of all the equations in~(\ref{rku_3_1})
and~(\ref{rku_3_2}) equal to zero.
Take $\hat f$ to be either $\hat{f}_3$ or $\hat{f}_4$. Put $q = (\rku)_3|_{\hat{f}}$ in~(\ref{rku_3_1}).
It yields
\begin{IEEEeqnarray*}{rCl}
  \int\limits_{\hat{f}} ((\rku)_3)^2\,d\hat{\gamma} & = & 0
\end{IEEEeqnarray*}
so there is a polinomial $\hat{q}_3\in(\mathcal{P}_{\hat{E}})_3$ such that
$(\rku)_3 \xyz = \hat{x}_3(\hat{x}_3-1)\,\hat{q}_3\xyz$
and the Lemma will follow once we apply the degrees of freedom~(\ref{rku_3_2})
with $\br$ set equal to $(0,0,\hat{q}_3)^t$. 
\end{proof}
\begin{lemma}\label{lemma_u1_u2} If $\hat\bu\xyz = (0,0, \hat{u}_3\xyz)^t$,
then $\rku\xyz = (0,0,\hat{\xi}_3\xyz)$ for some $\hat{\xi}_3\in
P_{k-1}(\hat{f}_3)\otimes P_k(\hat{x}_3)$.
\end{lemma}
\begin{proof}
In a completely analogous way as was done in Section~\ref{sub:defEdgeElement}
we can derive the following expressions for 
$\rku = (\hat{p}_1, \hat{p}_2, \hat{p}_3)^t \in  P_{\hat{E}}$: 
\begin{IEEEeqnarray*}{rCl}
  \hat{p}_1\xyz & = & \hat{q}_1\xyz + \hat{x}_1\,\hat{h}\xyz\\
  \label{exprPrt}\yesnumber
  \hat{p}_2\xyz & = & \hat{q}_2\xyz + \hat{x}_2\,\hat{h}\xyz\\
  \hat{p}_3\xyz & = & \hat{q}_3\xyz
\end{IEEEeqnarray*}
for unique $\hat{q}_1, \hat{q}_2 \in \mathcal{P}_{k-1}(\hat{f}_3)
\otimes\mathcal{P}_{k-1}(\hat{x}_3)$,
$\hat{q}_3 \in \mathcal{P}_{k-1}(\hat{f}_3)\otimes\mathcal{P}_{k}(\hat{x}_3)$,
and
$\hat{h} \in \tilde{\mathcal{P}}_{k-1}(\hat{f}_3)\otimes\mathcal{P}_{k-1}(\hat{x}_3)$.
Take an arbitrary $\hat{q}\in\mathcal{P}_{k-1}(\hat f_1)\otimes\mathcal P_{k-1}(\hat z)$.
Continuing with the technique developed for Section~\ref{stab_edge_prism}, 
the trick will be to apply Green's Theorem to the field
$(\hat{p}_1, \hat{p}_2, 0)^t$ and the scalar $\hat{q}$. By the surface degrees of
freedom~(\ref{momentos2hdiv}) and the volume degrees of freedom~(\ref{momentos3hdiv}) we have
  \begin{IEEEeqnarray*}{rClCl}
    \int\limits_{\hat{E}} \mbox{div}(\hat{p}_1, \hat{p}_2, 0)^t\,\hat{q}\,d\hat{\bx}&=&
    \int\limits_{\partial\hat{E}} (\hat{p}_1, \hat{p}_2, 0)^t\cdot\boldsymbol{\hat\nu}\,\hat{q}\,d\hat{\gamma}
    - \int\limits_{\hat{E}} (\hat{p}_1, \hat{p}_2, 0)^t\cdot\nabla \hat{q}\,d\hat{\bx}&&\\[5pt]
    & = &
    \int\limits_{\hat{f}_5} (\hat{u}_1 + \hat{u}_2)
    \hat{q}_{|_{\hat{f}_5 = 1}}\,d\hat{\gamma}
    - \int\limits_{\hat{f}_1} \hat{u}_1 \hat{q}_{|_{\hat{f}_1}}\,d\hat{\gamma}&&\\[5pt]
    &&\,- \int\limits_{\hat{f}_2} \hat{u}_2 \hat{q}_{|_{\hat{f}_2}}\,d\hat{\gamma}
    - \int\limits_{\hat{E}} \hat{u}_1
    \frac{\partial\hat{q}}{\partial{\hat{x}_1}} 
      + \hat{u}_2\frac{\partial\hat{q}}{\partial{\hat{x}_2}}\,d\hat{\bx} & = & 0.
  \end{IEEEeqnarray*}
  And since $\mbox{div}(\hat{p}_1, \hat{p}_2, 0)^t$ also belongs to
  $\pp{k-1}{k-1}$, we just established it vanishes on all $\hat{E}$.\\[3pt]
  In a similar way as done in Lemma~\ref{lemma_PIu2_k_in_N}, eq.~(\ref{h_is_zero}),
  we get to prove $\hat{h} \equiv 0$ in expression~(\ref{exprPrt}). It means we may
  assume that $\hat{p}_1$ and $\hat{p}_2$ belong to 
  $\mathcal{P}_{k-1}(\hat{f}_3)\otimes\mathcal{P}_{k-1}(\hat{x}_3)$.
  Now it is convenient to use again the degrees of freedom on the
  faces normal to $(-1, 0, 0)^t$ and $(0, -1, 0)^t$.
  The conditions
  \begin{IEEEeqnarray*}{rCCCl}
    \rho_{\hat f_1\,\hat q}(\rku) & = & \int\limits_{\hat f_1} \hat{p}_1\hat q\,d\hat\gamma
    & = & 0\qquad\mbox{for all }\hat{q}\in\mathcal{P}_{k-1}(\hat f_1)\\
    \rho_{\hat f_2\,\hat q}(\rku) & = & \int\limits_{\hat f_2} \hat{p}_2\hat q\,d\hat\gamma
    & = & 0\qquad\mbox{for all }\hat{q}\in\mathcal{P}_{k-1}(\hat f_2)
  \end{IEEEeqnarray*}
  ensure that $\hat{x}_i$ divides $\hat{p}_i$ for both $i=1,2$.
%  In other words, there are $\phi$ and $\psi$ in $\pp{k-2}{k-1}$ such that
%  \begin{IEEEeqnarray*}{rCl}
%    \hat{p}_1 & = & \hat{x}\,\phi\\
%    \hat{p}_2 & = & \hat{y}\,\psi.
%  \end{IEEEeqnarray*}
But finally, if we evaluate the degrees of freedom~(\ref{momentos3hdiv}),
we see that  $\hat{p}_1 = (\rku)_1$ and 
$\hat{p}_2 = (\rku)_2$ can be no other that
constantly null over all $\hat{E}$. 
\end{proof}
\begin{lemma}
\begin{itemize}
  \item []
  \item [(a)]\label{piu2_k_in_N} If $\hat\bu(\hat x_1,\hat x_2,\hat x_3) =
  (0, \hat{u}_2(\hat x_1,\hat x_3), 0)^t$,
  then $\rku\xyz = (0, \hat\xi_2(\hat x_1, \hat x_3) ,0)^t$ for some 
  $\hat\xi_2 \in P_{k-1}(\hat{x}_2) \otimes P_k(\hat{x}_3)$.
  \item [(b)]\label{piu1_k_in_N} If $\hat\bu(\hat x_1,\hat x_2,\hat x_3) = 
  (\hat{u}_1(\hat x_2,\hat x_3), 0, 0)^t$
  then $\rku\xyz = (\hat\xi_1(\hat x_2,\hat x_3), 0 ,0)^t$ for some
    $\hat\xi_1\in P_{k-1}(\hat{x}_1) \otimes P_k(\hat{x}_3)$.
\end{itemize}
\end{lemma}
\begin{proof} Let us prove the first one of the two claims. The second one 
  has an entirely analogous proof. By Lemma~\ref{lemmaRT3zero} we get
  $(\rku)_3 = 0$.
  The nullity of $\dv\hat{\bu}$ and the commutative
  diagram property~(\ref{lema_pi_star_rot_u}) give us
  $\dv\rku = 0$.
  This last fact, together with the result of the evaluation of the 
  degrees of freedom~(\ref{momentos2hdiv})
  on the face $\hat f_1 \subseteq \{x_1=0\}$
  and~(\ref{momentos3hdiv}) over $\hat E$, implies, as we have seen in
  Lemma~\ref{lemma_u1_u2}, that $(\rku)_1 = 0$.
  And if look again at 
  $\dv\rku = {\partial\rku}/{\partial\hat x_2} = 0$
  we have that $(\rku)_2$ does not depend on $\hat x_2$.
\end{proof}
\noindent It is time to state and prove the Theorem that was the purpose of this section.
\begin{theorem}\label{thm_stab_div} Given $\hat{\bu} \in W^{1,1}(\hat{E})$
\begin{IEEEeqnarray}{rCl}
\label{teoremaDiv_1} \norm{(\rku)_1}_{L^{\infty}(\hat{E})} & 
    \lesssim & \|\hat{u}_1\|_{W^{1,1}(\hat{E})} + 
    \|\emph{div}(\hat{u}_1, \hat{u}_2, 0)\|_{L^{1}(\hat{E})} \\ 
\label{teoremaDiv_2} \norm{(\rku)_2}_{L^{\infty}(\hat{E})} & 
    \lesssim & \|\hat{u}_2\|_{W^{1,1}(\hat{E})} + 
    \|\emph{div}(\hat{u}_1, \hat{u}_2, 0)\|_{L^{1}(\hat{E})} \\ 
\label{teoremaDiv_3} \norm{(\rku)_3}_{L^{\infty}(\hat{E})} & 
    \lesssim & \|\hat{u}_3\|_{W^{1,1}(\hat{E})}
\end{IEEEeqnarray}
where the constants in the inequalities depend olny on $\hat{E}$.
\end{theorem}
\begin{remark}\label{density_wpcurl}
  Denote with $\omega$ the closure of $\hat{E}$.
  The space $\mathcal{C}^\infty(\omega)^3$ is dense in
  $W^p(\curl,\hat{E})$ with its norm defined in~(\ref{normaWpcurl}).
  The proof follows techniques which can be learned from Chapter $3$
  in the book~\cite{adams} of Adams.
  {\color{blue}\#\#\#\#\#\#\#\# poner un esbozo de la prueba, mirar chap 3 adams
  si queda tiempo.}
\end{remark}
\begin{proof}[Proof of Theorem~\ref{thm_stab_div}] The proof is based on the
last three Lemmas. By Remark~\ref{density_wpcurl} we can state the estimate for
a smooth field $\hat{\bu}$ and then finish the proof with a density argument.\\[4pt]
Take again $\omega$ as the closure of $\hat{E}$ and 
$\hat\bu\in\mathcal{C}^\infty(\omega)^3$. Let
us prove the first inequality. Set
$\hat{\bv} = (\hat{u}_1, \hat{u}_2 - \hat{u}_2(\hat{x}_1,0,\hat{x}_3), 0)$.
Then $(\hat{\br}_k\bv)_1 = (\rku)_1$.
By evaluating the degrees of freedom to $\hat{\bv}$ we observe
that some of them vanish or depend exclusively on $\hat{u}_1$ in the way
we need them to depend on $\hat{u}_1$. As for the others,
pick first 
$\hat{q}_0 \in \mathcal{P}_{\hat{f}_5} = 
P_{k-1}(\hat{x}_1)\otimes P_{k-1}(\hat{x}_3)$
and extend it as the same polynomial  
$\hat{q}$ to $Q_{k-1,k-1,k-1}$.
\begin{IEEEeqnarray*}{rCl}
  \rho_{\hat{f}_5,\,\hat{q}_0} (\hat{\bv})
  & = & \int\limits_{\hat{f}_5} \hat{u}_1\,\hat{q}_0\,d\hat{\gamma} + 
  \sqrt{2}\iint\limits_{[0,1]^2} \hat{q}_0(\hat{x}_1,\hat{x}_3)
  \int_0^{1-\hat{x}_1}\frac{\partial \hat{v}_2}{\partial\hat{x}_2}
    (\hat{x}_1,\hat{t},\hat{x}_3)\,d\hat{t}d\hat{x}_1d\hat{x}_3\\[5pt]    
  & = & \int\limits_{\hat{f}_5} \hat{u}_1\,\hat{q}_0\,d\hat{\gamma} + 
  \sqrt{2}\int\limits_{\hat{E}} \hat{q}\frac{\partial \hat{v}_2}{\partial\hat{x}_2}\,d\hat{\bx}\\[5pt]    
  & = & \int\limits_{\hat{f}_5} \hat{u}_1\,\hat{q}_0\,d\hat{\gamma} + 
  \sqrt{2}\int\limits_{\hat{E}} \hat{q}\,\{\,\mbox{div} (\hat{u}_1,\hat{u}_2,0)^t -
    \frac{\partial \hat{u}_1}{\partial\hat{x}_1}\,\}\,d\hat{\bx}.
\end{IEEEeqnarray*}
For the volume degrees of freedom~(\ref{momentos3hdiv}) take $\hat{q}_2
\in P_{k-2}(\hat{f}_3) \otimes P_{k-1}(\hat{x}_3)$. Write 
$\hat{v}_2\xyz = \int_0^{\hat{x}_2} 
\nicefrac{\partial\hat{u}_2}{\partial\hat{x}_2}(\hat{x}_1,\hat{t},\hat{x}_3)\,d\hat{t}$ and do
{\color{brown}\#\#\#\#\#\#\#\# partir este array para pasar de p'agina.}
\begin{IEEEeqnarray*}{rCl}
  \int\limits_{\hat{E}} \hat{v}_2\,\hat{q}_2 
  & = &\int\limits_0^1\int\limits_0^1\int\limits_0^{1-\hat{x}_1}
  \int\limits_0^{\hat{x}_2}
    \frac{\partial \hat{u}_2}{\partial \hat{x}_2} 
    (\hat{x}_1,\hat{t},\hat{x}_3)\,d\hat{t}\,\hat{q}_2\xyz\,d\hat{x}_2\,d\hat{x}_1\,d\hat{x}_3\\
  & = &\int\limits_0^1\int\limits_0^1\int\limits_0^{1-\hat{x}_1}\int\limits_0^{\hat{x}_2}
        \frac{\partial\hat{u}_2}{\partial\hat{x}_2}(\hat{x}_1,\hat{t},\hat{x}_3)
        \,\hat{q}_2 \xyz\,d\hat{t}\,d\hat{x}_2\,d\hat{x}_1\,d\hat{x}_3\\
  & = &\int\limits_0^1\int\limits_0^1\int\limits_0^{1-\hat{x}_1}\int\limits_{\hat{t}}^{1-\hat{x}_1}
        \frac{\partial\hat{u}_2}{\partial\hat{x}_2}(\hat{x}_1,\hat{t},\hat{x}_3)\,\hat{q}_2\xyz\,
        d\hat{x}_2\,d\hat{t}\,d\hat{x}_1\,d\hat{x}_3\\
  & = &\int\limits_0^1\int\limits_0^1\int\limits_0^{1-\hat{x}_1}
        \frac{\partial \hat{u}_2}{\partial \hat{x}_2}(\hat{x}_1,\hat{t},\hat{x}_3)
        \int\limits_{\hat{t}}^{1-\hat{x}_1}\,\hat{q}_2\xyz\,d\hat{x}_2\,d\hat{t}\,d\hat{x}_1\,d\hat{x}_3\\
  & = &\int\limits_0^1\int\limits_0^1\int\limits_0^{1-\hat{x}_1}
  \frac{\partial\hat{u}_2}{\partial\hat{x}_2}(\hat{x}_1,\hat{t},\hat{x}_3)\,
       \hat{\phi} (\hat{x}_1,\hat{t},\hat{x}_3)\,d\hat{t}\,d\hat{x}_1\,d\hat{x}_3\\
& = &\int\limits_{\hat{E}} \mbox{div} (\hat{u}_1,\hat{u}_2,0)^t\,\hat{\phi}\,d\hat{\bx}
    - \int\limits_{\hat{E}}\frac{\partial\hat{u}_1}{\partial\hat{x}_1}\,\hat{\phi}\,d\hat{\bx}
\end{IEEEeqnarray*}
(for some $\hat{\phi} \in  P_{k-1}(\hat{f}_3)\otimes P_{k-1}(\hat{x}_3)$),
which is what we needed. The inequality~(\ref{teoremaDiv_2}) is proved in the same way.
For inequality~(\ref{teoremaDiv_3})
\begin{IEEEeqnarray*}{rCl}
  (\rku)_3 & = & (\hat{\br}_k(0,0,\hat{u}_3)^t)_3\\
  & = & \sum_{i=3,4\,\hat{\bq}\,\in\,{\color{red}\mathcal{B}_{\hat f_i}}}
  \int\limits_{\hat f_i} \hat{u}_3 \hat{q}_3\,d\hat{\gamma} \,(\hat{\bv}_{\hat{f}_i,\hat{\bq}})_3
    +\sum_{\hat{\br}\,\in\,{\color{red}\mathcal{B}_{\hat E}}}
  \int\limits_{\hat E} \hat{u}_3 \hat{r}_3\,d\hat{\bx}\,(\hat{\bv}_{\hat{\br}})_3.
\end{IEEEeqnarray*}
Then, by standard result for traces in Sobolev spaces,
\begin{IEEEeqnarray*}{rCl}
  \|(\rku)_3\|_{L^\infty(\hat{E})} 
  & \leqslant & c(\hat{E}) \left\{
   \sum_{i=3,4}
     \int\limits_{\hat f_i} |\hat{u}_3|\,d\hat{\gamma}
   + \int\limits_{\hat E} |\hat{u}_3|\,d\hat{\bx}
  \right\}\\
  &\leqslant& c(\hat{E}) (\|\hat{u}_3|_{\partial\hat{E}}\|_{L^1(\partial\hat{E})} + 
    \|\hat{u}_3\|_{L^1(\hat{E})})\\
  &\leqslant& c(\hat{E}) \|\hat{u}_3\|_{W^{1,1}(\hat{E})}
\end{IEEEeqnarray*}
\end{proof}
Theorems~\ref{thm_stab_edge} and~\ref{thm_stab_div} show that the interpolations
determined by the Finite Elements~(\ref{edgeelement}) and~(\ref{defi_h_div_conforme})
are anisotropically stable, in the sense that the image of a field $\hat\bu$ under
the linear operator depends not only continously on $\hat\bu$, but also with a
\emph{componentwise} bound, with perhaps and additional
curl or divergence term, respectively.\\

\noindent Consider again the element $\tilde{E}$ defined in~(\ref{tilde_prism}).
\begin{theorem} \label{thmStabilityKtildeRT}
There is $C > 0$, independent of $h_1$, $h_2$ and $h_3$, s.t. for all $p \geqslant 1$ and 
  $\tilde{\bu}\in W^{1,p}(\tilde{E})$
  \begin{IEEEeqnarray*}{rCl}
    \left\| \rkutilde \right\|_{L^p(\tilde{E})}
    & \leqslant & C \left( \left\| \tilde{\bu} \right\|_{L^p(\tilde{E})}
    + \sum_{i=1}^3 h_i \left\| \frac{\partial\tilde{\bu}}{\partial\tilde{x}_i} \right\|_{L^p(\tilde{E})}
    + \max\{h_1,h_2\}\left\|{\dv}(\tilde{u}_1, \tilde{u}_2, 0) \,\right\|_{L^p(\tilde{E})}\right).
  \end{IEEEeqnarray*}
\end{theorem}
\begin{remark}
{\color{red}esto va en el cap. de approx tal vez}  When it comes to estimate in terms of the data $f$ we
  will assume $h_3 \geqslant C\max\{h_1,h_2\}$ to be able to do
  \begin{IEEEeqnarray*}{rCl}
    \left\| \rkutilde \right\|_{L^p(\tilde{E})}
    & \leqslant & C \left( \left\| \tilde{\bu} \right\|_{L^p(\tilde{E})}
    + \sum_{i=1}^3 h_i \left\| \frac{\partial\tilde{\bu}}{\partial\tilde{x}_i} \right\|_{L^p(\tilde{E})}
    + \max\{h_1,h_2\}\left\|{\dv}\hat\bu\right\|_{L^p(\tilde{E})}
    + \max\{h_1,h_2\}\left\|\frac{\partial\hat u_3}{\partial\hat x_3}\right\|_{L^p(\tilde{E})}\right).\\[5pt]
    &\leqslant& C \left( \left\| \tilde{\bu} \right\|_{L^p(\tilde{E})}
    + \sum_{i=1}^3 h_i \left\| \frac{\partial\tilde{\bu}}{\partial\tilde{x}_i} \right\|_{L^p(\tilde{E})}
    + \max\{h_1,h_2\}\left\|{\dv}\hat\bu\right\|_{L^p(\tilde{E})}\right).
  \end{IEEEeqnarray*}
  this is not a restriction since we needed the prisms to be 
  elongated exactly along the direction paralell to the cuadrilateral faces.
\end{remark}
\begin{proof}
Pick $p\geqslant 1$. If we pull 
$\tilde{\bu}$ back to $\hat{E}$ we get the relation
\begin{IEEEeqnarray}{rCl}\label{pull1}
  \hat{\bu}(\hat{\bx}) & = & (det\,DF)DF^{-1}\tilde{\bu}(F\hat{\bx})
\end{IEEEeqnarray}
\begin{IEEEeqnarray}{rCl}
  D\hat{\bu}(\hat{\bx}) & = & \diag{h_2\,h_3}{h_1\,h_3}{h_1\,h_2}D\tilde{\bu}(F\hat{\bx})\diag{h_1}{h_2}{h_3}
\end{IEEEeqnarray}
and by~(\ref{push-forward})
\begin{IEEEeqnarray}{rCl}\label{pull2}
  (\det DF)DF^{-1}\rkutilde(F(\hat{\bx})) & = & \rku(\hat{\bx}).
\end{IEEEeqnarray}
With~(\ref{pull1})~(\ref{pull2}) and 
stability inequality~(\ref{teoremaDiv_1}) 
plus H\"older's inequality we obtain 
\begin{IEEEeqnarray*}{rCl}
  \|(\rkutilde)_1\|_{L^{\infty}(\tilde{E})} & = &
  (h_2\,h_3)^{-1}
  \|(\rku)_1\|_{L^{\infty}(\hat{E})}\\[7pt]
  &\leqslant&(h_2\,h_3)^{-1}\left(\|\hat{u}_1\|_{W^{1,1}(\hat{E})}
  +\|\dvg(\hat{u}_1,\hat{u}_2,0)^t\|_{L^{1}(\hat{E})}\right)\\[7pt]
  &=& 
  (h_2\,h_3)^{-1}
  \left(
    \int\limits_{\hat{E}}\left|\hat{u}_1\right|\,d\hat{\bx}
    +\sum_{i=1}^3\int\limits_{\hat{E}}\left|\frac{\partial\hat{u}_1}{\partial\hat{x}_i}\right|\,d\hat{\bx}
    +\int\limits_{\hat{E}}\left|\frac{\partial\hat{u}_1}{\partial\hat{x}_1} + \frac{\partial\hat{u}_2}{\partial\hat{x}_2}\right|
    \,d\hat{\bx}
  \right)\\[7pt]
  &=&(\det DF)^{-1}\left(
  \int\limits_{\tilde{E}}|\tilde{u}_1|\,d\tilde{\bx}
  +\sum_{i=1}^3h_i\int\limits_{\tilde{E}}|\frac{\partial\tilde{u}_1}{\partial\tilde{x}_i}|\,d\tilde{\textbf{x}}
  +h_1\int\limits_{\tilde{E}}|\frac{\partial\tilde{u}_1}{\partial\tilde{x}_1} + \frac{\partial\tilde{u}_2}{\partial\tilde{x}_2}|
  \,d\tilde{\textbf{x}}\right)\\[7pt]
  &=&(2|\tilde{E}|)^{-1}\left(
  \|\tilde{u}_1\|_{L^1(\tilde{E})}
  +\sum_{i=1}^3h_i\|\frac{\partial\tilde{u}_1}{\partial\tilde{x}_i}\|_{L^1(\tilde{E})}
  +h_1\|\dvg(\tilde{u}_1,\tilde{u}_2,0)\|_{L^1(\tilde{E})}\right)\\[7pt]
  &\leqslant&(2|\tilde{E}|^{\nicefrac{1}{p}})^{-1}\left(
  \|\tilde{u}_1\|_{L^p(\tilde{E})}
  +\sum_{i=1}^3h_i\|\frac{\partial\tilde{u}_1}{\partial\tilde{x}_i}\|_{L^p(\tilde{E})}
  +h_1\|\dvg(\tilde{u}_1,\tilde{u}_2,0)\|_{L^p(\tilde{E})}\right).
\end{IEEEeqnarray*}
Now
\begin{IEEEeqnarray*}{rCl}
  \|(\rkutilde)_1\|_{L^{p}(\tilde{E})}
  &\leqslant&
  |\tilde{E}|^{1/p}\|(\tilde{\br}_k\tilde{\boldsymbol{u}})_1\|_{L^{\infty}(\tilde{E})}\\
  &\lesssim&\|\tilde{u}_1\|_{L^p(\tilde{E})}
  +\sum_{i=1}^3h_i\|\frac{\partial\tilde{u}_1}{\partial\tilde{x}_i}\|_{L^p(\tilde{E})}
  +h_1\|\dvg(\tilde{u}_1,\tilde{u}_2,0)\|_{L^p(\tilde{E})},
\end{IEEEeqnarray*}
and again, the symmetric inequality holds for component $2$. For component $3$,
stability inequality~(\ref{teoremaDiv_3}) gives us
\begin{IEEEeqnarray*}{rCl}
  \|(\rkutilde)_3\|_{L^{\infty}(\tilde{E})} & = &({h_1h_2})^{-1}
  \|(\rku)_3\|_{L^{\infty}(\hat{E})}\\[6pt]
  &\leqslant&{C}({h_1h_2})^{-1}\,\|\hat{u}_3\|_{W^{1,1}(\hat{E})}\\[6pt]
  &=&C\,|\tilde{E}|^{-1}\,\left[\|\tilde{u}_3\|_{L^1(\tilde{E})} +
    \sum_{i=1,2,3} h_i\,\left\|\frac{\partial\tilde{u}_3}{\partial\tilde{x}_i}\right\|_{L^1(\tilde{E})}\right]\\[6pt]
  &\leqslant& {C}\,|\tilde{E}|^{-\nicefrac{1}{p}}\,\left[\|\tilde{u}_3\|_{L^p(\tilde{E})} +
    \sum_{i=1,2,3} h_i\,\left\|\frac{\partial\tilde{u}_3}{\partial\tilde{x}_i}\right\|_{L^p(\tilde{E})}\right]
\end{IEEEeqnarray*}
so, immediately,
\begin{IEEEeqnarray*}{rCl}
  \|(\rkutilde)_3\|_{L^{p}(\tilde{E})}
  &\leqslant& C\,\left(
  \|\tilde{u}_3\|_{L^p(\tilde{E})} +
    \sum_{i=1,2,3} h_i\,\left\|\frac{\partial\tilde{u}_3}{\partial\tilde{x}_i}\right\|_{L^p(\tilde{E})}
  \right)
\end{IEEEeqnarray*}
and the sum of the three estimates yields the theorem.
\end{proof}
\subsection{Local Interpolation Estimates for Prismatic Elements} % (fold)
\label{sub:local_interpolation_estimates_for_prismatic_elements}
one of the main results in this thesis
\begin{theorem}\label{thmErrorInterpolacionPrismas}
Let $P$ be a right prism, and consider a local system of coordinates $x_1x_2x_3$ such that the triangular basis of $P$ are parallel to the $x_1x_2$-coordinate plane. Denote by $\xi_{P,1}$ and $\xi_{P,2}$ the versors parallel to the edges of the triangular basis of $P$ adjacent to its maximum angle $\alpha_P$, $\xi_{P,3}=(0,0,1)$ and $h_{P,i}$ are the lengths of the edges of $P$ parallel to $\xi_{P,i}$. We assume that $h_{P,3}>ch_{P,1}$ and $h_{P,3}>ch_{P,2}$. Then, there exists a constant $C$ depending only on $c$ and $\alpha_P$, such that for all $\bu\in H^1(P)$ we have
\begin{equation}\label{interp}
\|\bu-\boldsymbol{r}_E\bu\|_{L^2(E)} \leqslant C\left(\sum_{i=1}^3 h_{E,i} \|\partial_{\xi_{E,i}}\bu\|_{L^2(E)} + h_T\|\dv\bu\|_{L^2(E)}\right).
\end{equation}

\end{theorem}

% subsection local_interpolation_estimates_for_prismatic_elements (end)
% section prismatic_finite_elements (end)

\section{Pyramidal Finite Elements} % (fold)
\label{sec:pyramidal_finite_elements}
\begin{table}[!h]
    \centering  
    \caption{Notation for the faces and positive normals of $\partial\hat{E}$.}
    \label{pyramidNotationTableFaces}
    \begin{IEEEeqnarraybox*}
      [\IEEEeqnarraystrutmode
      \IEEEeqnarraystrutsizeadd{2pt}{6pt}]{v/c/x/c/x/c/x/v/x/c/x/c/x/c/v/}
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
          & \hat f_1 && \subseteq &&  \{\hat x_2 = 0 \}            && && \hat{\bn}_1 && = && (0,-1,0)' & \\
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
          & \hat f_2 && \subseteq &&  \{\hat x_1 = 0 \}            && && \hat{\bn}_2 && = && (-1,0,0)' &\\
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
          & \hat f_3 && \subseteq &&  \{\hat x_1 + \hat x_3 = 1 \} && && \hat{\bn}_3 && = && 2^{-\nicefrac{1}{2}}(1,0,1)' &\\
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
          & \hat f_4 && \subseteq &&  \{\hat x_2 + \hat x_3 = 1 \} && && \hat{\bn}_4 && = && 2^{-\nicefrac{1}{2}}(0,1,1)' &\\
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
          & \hat f_5 && \subseteq &&  \{\hat x_3 = 0\}             && && \hat{\bn}_5 && = && (0,0,-1)' &\\
        \IEEEeqnarrayrulerow
    \end{IEEEeqnarraybox*}
\end{table}

\begin{table}[!h]
    \centering  
    \caption{Notation for the edges and positive tangents of $\partial\hat{E}$.}
    \label{pyramidNotationTableEdges}
    \begin{IEEEeqnarraybox*}
      [\IEEEeqnarraystrutmode
      \IEEEeqnarraystrutsizeadd{2pt}{6pt}]{v/c/x/c/x/c/x/v/x/c/x/c/x/c/v/}
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
   & \hat \be_1 && = && \{(\hat x_1,0,0)^t\,:\,0\leqslant\hat x_1\leqslant 1\} && && \hat \btau_1 && = && (1,0,0)' & \\
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
   & \hat \be_2 && = && \{(1,\hat x_2,0)^t\,:\,0\leqslant\hat x_2\leqslant 1\} && && \hat \btau_2 && = && (0,1,0)' & \\
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
   & \hat \be_3 && = && \{(\hat x_1,1,0)^t\,:\,0\leqslant\hat x_1\leqslant 1\} && && \hat \btau_3 && = && (-1,0,0)' & \\
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
   & \hat \be_4 && = && \{(0,\hat x_2,0)^t\,:\,0\leqslant\hat x_2\leqslant 1\} && && \hat \btau_4 && = && (0,1,0)' & \\
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
   & \hat \be_5 && = && \{(0,0,\hat x_3)^t\,:\,0\leqslant\hat x_3\leqslant 1\} && && \hat \btau_5 && = && (0,0,1)' & \\
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
   & \hat \be_6 && = && \{(1-\hat x_3,0,\hat x_3)^t\,:\,0\leqslant\hat x_3\leqslant 1\} && && \hat \btau_6 && = && 2^{-\nicefrac{1}{2}}(-1,0,1)' & \\
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
   & \hat \be_7 && = && \{(0,1-\hat x_3,\hat x_3)^t\,:\,0\leqslant\hat x_3\leqslant 1\} && && \hat \btau_7 && = && 2^{-\nicefrac{1}{2}}(0,-1,1)' & \\
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
   & \hat \be_8 && = && \{(1-\hat x_3,1-\hat x_3,\hat x_3)^t\,:\,0\leqslant\hat x_3\leqslant 1\} && && \hat \btau_8 && = && 3^{-\nicefrac{1}{2}}(-1,-1,1) & \\
        \IEEEeqnarrayrulerow
    \end{IEEEeqnarraybox*}
\end{table}
\begin{figure}[!h]
\centering
\subfloat
{
  \label{unitTangPyr}
  \unitTangentsPyramid
}
\caption{Directions of the positive unit tangents (cfr. Table~\ref{pyramidNotationTableEdges}).}
  
\end{figure}



$\hat{E}$ will be the reference pyramid  in Figure~\ref{reference_pyramid}.

\subsection{Edge Elements} % (fold)
\label{sub:edge_elements}
\input{./chap_interpolation/stability_edge_ref_pyramid}
% subsection edge_elements (end)
\subsection{Face Elements} % (fold)
\label{sub:face_elements}

\paragraph{Stability $\hat{E}$} 
\label{par:stability_hat}
\begin{theorem}
\noindent{\color{blue}\#\#\#\#\#\#\# cambiar H1 por W1p a la derecha.
corregir en las estimaciones de la demostración porque
está todo con H1} 
\begin{IEEEeqnarray*}{rCl}
  \|(\rku)_1\|_{\scriptscriptstyle{L^p(\hat{E})}}
  &\lesssim& \|\hat u_1\|_{\scriptscriptstyle{W^{1,p}(\hat{E})}} +
    \|\dv \bu\|_{\scriptscriptstyle{L^p}(\hat{E})} + 
    \left\|\hat{u}_3\right\|_{\scriptscriptstyle{H^1}(\hat{E})}\\[12pt]
  \|(\rku)_2\|_{\scriptscriptstyle{L^p(\hat{E})}}
  &\lesssim& \|\hat u_2\|_{\scriptscriptstyle{W^{1,p}(\hat{E})}} +
    \|\dv \bu\|_{\scriptscriptstyle{L^p}(\hat{E})} + 
    \left\|\hat{u}_3\right\|_{\scriptscriptstyle{H^1}(\hat{E})}\\[12pt]
  \|(\rku)_3\|_{\scriptscriptstyle{L^p(\hat{E})}} & \lesssim & 
    \|u_3\|_{\scriptscriptstyle{W^{1,p}(\hat{E})}} +
    \|\dv \bu\|_{\scriptscriptstyle{L^p}(\hat{E})}.
\end{IEEEeqnarray*}
\end{theorem}

\begin{proof}
We will use the notation of Table~\ref{shape_edge_table} for the 
shape functions and Tables~\ref{pyramidNotationTableFaces} and
~\ref{pyramidNotationTableEdges} for the border of the pyramid. The variables 
in the local coordinate system of $\hat E$ are $x,y$ and $z$.\\[5pt]
Consider the case $\hat{\bu} = (\hat{u}_1,0,0)'$ and compute it's interpolate. 
\begin{IEEEeqnarray*}{rCl}
  \rku & = & ({\scriptstyle\iint_{\hat{f}_2} \bu \cdot \hat\bn_2\,d\gamma})\,\bzeta_2 + 
         \iint_{\hat{f}_3} \bu \cdot \hat\bn_3\,d\gamma\,\bzeta_3\\[4pt]
       & = & \alpha_2(\hat\bu)\,\bzeta_2 + \alpha_3(\hat\bu)\,\bzeta_3.
\end{IEEEeqnarray*}
Then 
\begin{IEEEeqnarray*}{rCl}
  (\rku)_1\xyz & = & -2\alpha_2(\hat\bu) + 
    (\alpha_2(\hat\bu)+\alpha_3(\hat\bu))\,\frac{2x-xz}{1-z}\\[4pt]
    & = & -2{\iint_{\hat{f}_2} \hat{\bu} \cdot \hat\bn_2\,d\gamma} + 
          ({\iint_{\hat{f}_2} \hat{\bu} \cdot \hat\bn_2\,d\gamma}+
                  {\iint_{\hat{f}_3} \hat{\bu} \cdot \hat\bn_3\,d\gamma})\frac{2x-xz}{1-z}\\[4pt]
    & = & -2{\iint_{\hat{f}_2} \hat{\bu} \cdot \hat\bn_2\,d\gamma} + 
          {\iint_{\partial\hat{E}} \hat{\bu} \cdot \hat\bn\,d\gamma}\frac{2x-xz}{1-z}\\[4pt]
    & = & -2{\iint_{\hat{f}_2} \hat{\bu} \cdot \hat\bn_2\,d\gamma} + 
            {\int_{\hat{E}} \dv\hat{\bu} \,d\hat{\boldsymbol{x}}}\frac{2x-xz}{1-z}.\\[8pt]
  (\rku)_2\xyz & = & -(\alpha_2(\hat\bu)+\alpha_3(\hat\bu))\,\frac{yz}{1-z}\\[4pt]
    & = & -{\int_{\hat{E}} \dv\hat{\bu} \,d\hat{\boldsymbol{x}}}\frac{yz}{1-z}.
\end{IEEEeqnarray*}
Switch to $\hat{\bu} = (0,\hat{u}_2,0)'$.
\begin{IEEEeqnarray*}{rCl}
  \rku & = & ({\scriptstyle\iint_{\hat{f}_1} \bu \cdot \hat\bn_1\,d\gamma})\,\bzeta_1 + 
         \iint_{\hat{f}_4} \bu \cdot \hat\bn_4\,d\gamma\,\bzeta_4\\[4pt]
       & = & \alpha_1(\hat\bu)\,\bzeta_1 + \alpha_4(\hat\bu)\,\bzeta_4.
\end{IEEEeqnarray*}
Then
\begin{IEEEeqnarray*}{rCl}
  (\rku)_1\xyz & = & -(\alpha_1(\hat\bu)+\alpha_4(\hat\bu))\,\frac{xz}{1-z}\\[4pt]
    & = & -{\int_{\hat{E}} \dv\hat{\bu} \,d\hat{\boldsymbol{x}}}\frac{xz}{1-z}.\\[8pt]
  (\rku)_2\xyz & = & -2\alpha_1(\hat\bu) + 
  (\alpha_1(\hat\bu)+\alpha_4(\hat\bu))\,\frac{2y-yz}{1-z}\\[4pt]
    & = & -2{\iint_{\hat{f}_1} \hat{\bu} \cdot \hat\bn_1\,d\gamma} + 
            {\iint_{\partial\hat{E}} \hat{\bu} \cdot \hat\bn\,d\gamma}\frac{2y-yz}{1-z}\\[4pt]
    & = & -2{\iint_{\hat{f}_1} \hat{\bu} \cdot \hat\bn_1\,d\gamma} + 
            {\int_{\hat{E}} \dv\hat{\bu} \,d\hat{\boldsymbol{x}}}\frac{2y-yz}{1-z}.\\[8pt]
\end{IEEEeqnarray*}
Switch to $\hat{\bu} = (0,0,\hat{u}_3)'$.
\begin{IEEEeqnarray*}{rCl}
  \rku & = & ({\scriptstyle\iint_{\hat{f}_3} \bu \cdot \hat\bn_3\,d\gamma})\,\bzeta_3 + 
         \iint_{\hat{f}_4} \bu \cdot \hat\bn_4\,d\gamma\,\bzeta_4 + 
         \iint_{\hat{f}_5} \bu \cdot \hat\bn_5\,d\gamma\,\bzeta_5\\[4pt]
       & = & \alpha_3(\hat\bu)\,\bzeta_3 + \alpha_4(\hat\bu)\,\bzeta_4
       + \alpha_5(\hat\bu)\,\bzeta_5.
\end{IEEEeqnarray*}
Then
\begin{IEEEeqnarray*}{rCl}
  (\rku)_1\xyz & = & (\alpha_3(\hat\bu)+\alpha_5(\hat\bu))x
  + \alpha_3(\hat\bu) \frac{x}{1-z} - \alpha_4\frac{xz}{1-z}.
\end{IEEEeqnarray*}
Now observe
\begin{IEEEeqnarray*}{rCl}
  (\alpha_3(\hat\bu)+\alpha_5(\hat\bu)) & = & 
    {\iint_{\partial\hat{E}} \hat{\bu} \cdot \hat\bn\,d\gamma} - 
      {\iint_{\hat{f}_4} \hat{\bu} \cdot \hat\bn_4\,d\gamma} \\[4pt]
  & = & {\int_{\hat{E}} \dv\hat{\bu}\,d\hat{\boldsymbol{x}}} - 
        \alpha_4(\hat{\bu})
\end{IEEEeqnarray*}
and
\begin{IEEEeqnarray*}{rCl}
  \alpha_3(\hat\bu)-\alpha_4(\hat\bu) & = & 
  {\iint_{\hat{f}_3} \bu \cdot \hat\bn_3\,d\gamma} - 
  {\iint_{\hat{f}_4} \bu \cdot \hat\bn_4\,d\gamma} \\[4pt]
  & = & \int_{0}^{1}\int_{0}^{x} \hat{u}_3(x,y,1-x)\,dydx - 
        \int_{0}^{1}\int_{0}^{y} \hat{u}_3(x,y,1-y)\,dxdy\mbox{,}
\end{IEEEeqnarray*}
so
\begin{IEEEeqnarray*}{rCl}
  (\rku)_1\xyz & = & {\int_{\hat{E}} \dv\hat{\bu}\,d\hat{\boldsymbol{x}}}\,x +\\[4pt]
  \IEEEeqnarraymulticol{3}{r}{\qquad(\int_{0}^{1}\int_{0}^{x} \hat{u}_3(x,y,1-x)\,dydx - 
                          \int_{0}^{1}\int_{0}^{y} \hat{u}_3(x,y,1-y)\,dxdy)
                        \frac{x}{1-z}.}
\end{IEEEeqnarray*}
In a completely similar fashion
\begin{IEEEeqnarray*}{rCl}
  (\rku)_2\xyz & = & {\int_{\hat{E}} \dv\hat{\bu}\,d\hat{\boldsymbol{x}}}\,y\,+
  ({\iint_{\hat{f}_3} \bu \cdot \hat\bn_3\,d\gamma} - 
   {\iint_{\hat{f}_4} \bu \cdot \hat\bn_4\,d\gamma})\frac{y}{1-z}.\\[4pt]
               & = & {\int_{\hat{E}} \dv\hat{\bu}\,d\hat{\boldsymbol{x}}}\,y\,+\\[4pt]
  \IEEEeqnarraymulticol{3}{r}{\qquad(\int_{0}^{1}\int_{0}^{x} \hat{u}_3(x,y,1-x)\,dydx - 
                          \int_{0}^{1}\int_{0}^{y} \hat{u}_3(x,y,1-y)\,dxdy)
                        \frac{y}{1-z}.}
\end{IEEEeqnarray*}
We collect every term obtained so far for the first and second components in
Table~\ref{terms_table}.
\begin{table}[!h]
    \centering  
    \caption{Terms\\[4pt]$q(s,t) = \frac{2s-st}{1-t},\,r(s,t) = \frac{st}{1-t}$}
    \label{terms_table}
    \begin{IEEEeqnarraybox*}
    [\IEEEeqnarraystrutmode
    \IEEEeqnarraystrutsizeadd{2pt}{12pt}]{v/c/v/c/v/c/v/}
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
        & & & (\rku)_1 & & (\rku)_2 & \\
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
        & (\hat{u}_1,0,0)' & &
          \begin{IEEEeqnarraybox*}{l}
            -2{\iint_{\hat{f}_2} \hat{\bu} \cdot \hat\bn_2\,d\gamma}\\ + 
            {q(x,z)\int_{\hat{E}} \dv\hat{\bu} \,d\hat{\boldsymbol{x}}}
          \end{IEEEeqnarraybox*}
        & &
          -r(y,z){\int_{\hat{E}} \dv\hat{\bu} \,d\hat{\boldsymbol{x}}} &\\
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
        & (0,\hat{u}_2,0)' & & 
          -r(x,z){\int_{\hat{E}} \dv\hat{\bu} \,d\hat{\boldsymbol{x}}} 
        & & 
          \begin{IEEEeqnarraybox*}{l}
            -2{\iint_{\hat{f}_1} \hat{\bu} \cdot \hat\bn_1\,d\gamma}\\ + 
            {q(x,z)\int_{\hat{E}} \dv\hat{\bu} \,d\hat{\boldsymbol{x}}}
          \end{IEEEeqnarraybox*}
        &\\
        \IEEEeqnarrayrulerow\\
        \IEEEeqnarrayseprow[5pt]\\
        & (0,0,\hat{u}_3)' & & 
          \begin{IEEEeqnarraybox*}{l}
            x\int_{\hat{E}} \dv\hat{\bu}\,d\hat{\boldsymbol{x}} \\[5pt] +\, 
            ({\iint_{\hat{f}_3} \bu \cdot \hat\bn_3\,d\gamma}
             \\[5pt] 
             -{\iint_{\hat{f}_4} \bu \cdot \hat\bn_4\,d\gamma})r(x,z)
          \end{IEEEeqnarraybox*}
         & & 
          \begin{IEEEeqnarraybox*}{l}
            y\int_{\hat{E}} \dv\hat{\bu}\,d\hat{\boldsymbol{x}}\\[5pt] +\, 
              ({\iint_{\hat{f}_4} \bu \cdot \hat\bn_4\,d\gamma}
             \\[5pt] 
             -{\iint_{\hat{f}_3} \bu \cdot \hat\bn_3\,d\gamma})r(y,z)
          \end{IEEEeqnarraybox*}
        &\\\IEEEeqnarrayrulerow
    \end{IEEEeqnarraybox*}
\end{table}
Lastly, for any $\hat\bu$
\begin{IEEEeqnarray*}{rCl}
    (\rku)_3\xyz & = &   z\sum_{i=1}^4\iint_{\hat{f}_i} \hat{\bu}\cdot\hat{\bn}_i\,d\gamma
                      + (z-1) \iint_{\hat{f}_5}\hat{\bu}\cdot\hat{\bn}_5\,d\gamma\\[5pt]
                 & = & z\iint_{\partial\hat{E}} \hat{\bu}\cdot\hat{\bn} - \iint_{f_5}
                 \hat{\bu}\cdot\hat{\bn}_5\,d\gamma\\[5pt]
   \yesnumber\label{term_rk3}
                 & = &\hat{x}_3\int\limits_{\hat{E}} \mbox{div}\,\hat{\bu}\,d\hat{\bx} 
     + \iint\limits_{\hat{f}_5} \hat{u}_3\,d\hat{\gamma}
\end{IEEEeqnarray*}
Now we bound each term 
\begin{IEEEeqnarray*}{rCl}
  (\rku)_1 & = & (\br_{\hat{E}}(\hat{u}_1,0,0)')_1 + 
                 (\br_{\hat{E}}(0,\hat{u}_2,0)')_1 + 
                 (\br_{\hat{E}}(0,0,\hat{u}_3)')_1\\[5pt]
  & = & -2\iint_{\hat{f}_2}\hat{u}_1\,d\gamma +
  \frac{2x}{1-z}\int_{\hat{E}} \frac{\partial\hat{u}_1}{\partial\hat{x}_1}\,d\hat{\bx} -
  \frac{xz}{1-z}\int_{\hat{E}} \frac{\partial\hat{u}_1}{\partial\hat{x}_1}\,d\hat{\bx} \\[5pt]
  & & \,- \frac{xz}{1-z}\int_{\hat{E}} \frac{\partial\hat{u}_2}{\partial\hat{x}_2}\,d\hat{\bx}
  + \left( x + \frac{xz}{1-z}-\frac{xz}{1-z} \right)
  \int_{\hat{E}} \frac{\partial\hat{u}_3}{\partial\hat{x}_3}\,d\hat{\bx}\\[5pt]
  &   &\, + \left({\iint_{\hat{f}_3} \hat{u}_3\,d\gamma}
        - {\iint_{\hat{f}_4} \hat{u}_3\,d\gamma}\right)\frac{xz}{1-z}\\[5pt]
  & = & -2\iint_{\hat{f}_2}\hat{u}_1\,d\gamma +
  \frac{2x}{1-z}\int_{\hat{E}}\frac{\partial\hat{u}_1}{\partial\hat{x}_1}\,d\hat{\bx} -
  \frac{xz}{1-z}\int_{\hat{E}}\dv\hat{\bu}\,d\hat{\bx}\\[5pt]
  \yesnumber\label{face_integrals}
  &  & \,+\frac{x}{1-z}\int_{\hat{E}}\frac{\partial\hat{u}_3}{\partial\hat{x}_3}\,d\hat{\bx}
  + \left({\iint_{\hat{f}_3} \hat{u}_3\,d\gamma}
        - {\iint_{\hat{f}_4} \hat{u}_3\,d\gamma}\right)\frac{xz}{1-z}
\end{IEEEeqnarray*}
For the surface integrals in~(\ref{face_integrals}), by Theorem 3.9 in~\cite{monk}, page 43,
\begin{IEEEeqnarray*}{rCl}
  \left|\iint_{\hat{f}_2} \hat{u}_1\,d\gamma\right| 
  & \leqslant & 2^{-1/4}\,\|\mbox{Tr}_{\hat{f}_2}\hat{u}_1\|_{L^2(\hat{f}_3)} \\[5pt]
  & \leqslant & C\,\|\mbox{Tr\,}\hat{u}_1\|_{H^{\delta}(\partial\hat{E})} \\[5pt]
  & \leqslant & C\,\|\hat{u}_1\|_{H^{1/2+\delta}(\hat{E})}. \\[5pt]
  & \leqslant & C\,\|\hat{u}_1\|_{H^{1}(\hat{E})}.
\end{IEEEeqnarray*}
and similarly
\begin{IEEEeqnarray*}{rCl}
  \left|\iint_{\hat{f}_3} \hat{u}_3\,d\gamma - \iint_{\hat{f}_4} \hat{u}_3\,d\gamma\right| 
  & \leqslant & C\,\|\hat{u}_3\|_{H^{1}(\hat{E})}
\end{IEEEeqnarray*}
all of which leads to
\begin{IEEEeqnarray*}{rCl}
  \|(\rku)_1\|_{L^{\infty}(\hat{E})} & \leqslant & C_{\hat{E}} 
  \left[ 
    \|\hat{u}_1\|_{H^{1}(\hat{E})} + 
    \|\dv\hat{\bu}\|_{L^{2}(\hat{E})} + 
    \|\hat{u}_3\|_{H^{1}(\hat{E})}
  \right].
\end{IEEEeqnarray*}
Copying the argument for the second component
\begin{IEEEeqnarray*}{rCl}
  \|(\rku)_1\|_{L^{\infty}(\hat{E})} & \leqslant & C_{\hat{E}} 
  \left[ 
    \|\hat{u}_1\|_{H^{1}(\hat{E})} + 
    \|\dv\hat{\bu}\|_{L^{2}(\hat{E})} + 
    \|\hat{u}_3\|_{H^{1}(\hat{E})}
  \right].
\end{IEEEeqnarray*}
From~(\ref{term_rk3}) we deduce
\begin{IEEEeqnarray*}{rCl}
  \|(\rku)_3\|_{\scriptscriptstyle{L^\infty(\hat{E})}} & \leqslant & C_{\hat{E}}
    \left[\|u_3\|_{\scriptscriptstyle{H^{1}(\hat{E})}} +
    \|\dv \bu\|_{\scriptscriptstyle{L^2}(\hat{E})}\right].
\end{IEEEeqnarray*}
The quantity $C_{\hat{E}}$ depends only on the supremum of the (fixed)
basis shape functions of Table~\ref{shape_face_table} over the pyramid.
\end{proof}
% subsection face_elements (end)
\subsection{Local Interpolation Estimates for Pyramidal Elements} % (fold)
\label{sub:local_interpolation_estimates_for_pyramidal_elements}
decir que permitimos pirámides elongadas perpendicularmente a la base
$h_3\geqslant C\min\{h_1,h_2\}$
Verificar si es esto o $h3 >= max (h1, h2)$\\
poner tres dibujos con casos $h1=h2<h3$; $h1<h2<h3$; $h2<h1<h3$

% subsection local_interpolation_estimates_for_pyramidal_elements (end)

% section pyramidal_finite_elements (end) 

\input{./chap_interpolation/vemInterpolationPyramids}
